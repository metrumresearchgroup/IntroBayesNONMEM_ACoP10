      MODULE NMPRD4P
      USE SIZES, ONLY: DPSIZE
      USE NMPRD4,ONLY: VRBL
      IMPLICIT NONE
      SAVE
      REAL(KIND=DPSIZE), DIMENSION (:),POINTER ::COM
      REAL(KIND=DPSIZE), POINTER ::nThin,VWT,MU_1,MU_2,MU_3,MU_4,MU_5
      REAL(KIND=DPSIZE), POINTER ::MU_6,MU_7,MU_8,MU_9,MU_10,MU_11,CL
      REAL(KIND=DPSIZE), POINTER ::Q,V1,V2,KA,MTT,CIRC0,ALPHA,GAMMA
      REAL(KIND=DPSIZE), POINTER ::SIG1,SIG2,K10,K12,K21,KTR,KPROL
      REAL(KIND=DPSIZE), POINTER ::KCIRC,S2,S3,CONC,EDRUG,IPRED,IND
      REAL(KIND=DPSIZE), POINTER ::YPK,YPD,Y,A000098,A000100,A000103
      REAL(KIND=DPSIZE), POINTER ::A000105,A000106,A000112,A000111
      REAL(KIND=DPSIZE), POINTER ::A000107,A000117,A000122,A000128
      REAL(KIND=DPSIZE), POINTER ::A000127,A000123,A000133,A000138
      REAL(KIND=DPSIZE), POINTER ::A000144,A000143,A000139,A000149
      REAL(KIND=DPSIZE), POINTER ::A000154,A000159,A000176,A000177
      REAL(KIND=DPSIZE), POINTER ::A000178,A000179,A000180,A000181
      REAL(KIND=DPSIZE), POINTER ::A000182,A000183,A000184,A000185
      REAL(KIND=DPSIZE), POINTER ::A000186,A000187,A000188,A000189
      REAL(KIND=DPSIZE), POINTER ::A000190,A000191,A000192,A000193
      REAL(KIND=DPSIZE), POINTER ::A000194,A000195,A000196,A000197
      REAL(KIND=DPSIZE), POINTER ::A000198,A000199,A000200,A000201
      REAL(KIND=DPSIZE), POINTER ::A000202,A000203,A000204,A000205
      REAL(KIND=DPSIZE), POINTER ::A000206,A000207,A000208,A000209
      REAL(KIND=DPSIZE), POINTER ::A000210,E000010,F000081,E000012
      REAL(KIND=DPSIZE), POINTER ::E000013,E000014,F000084,F000086
      REAL(KIND=DPSIZE), POINTER ::F000085,F000087,E000019,E000020
      REAL(KIND=DPSIZE), POINTER ::F000088,F000089,E000042,E000044
      REAL(KIND=DPSIZE), POINTER ::E000043,F000129,F000128,F000131
      REAL(KIND=DPSIZE), POINTER ::F000130,F000127,F000132,E000111
      REAL(KIND=DPSIZE), POINTER ::E000110,F000191,E000117,E000116
      REAL(KIND=DPSIZE), POINTER ::F000192,E000123,E000122,F000193
      REAL(KIND=DPSIZE), POINTER ::E000126,E000127,F000194,F000195
      REAL(KIND=DPSIZE), POINTER ::D000001,D000002,D000003,D000004
      REAL(KIND=DPSIZE), POINTER ::D000005,D000006,D000007,D000008
      REAL(KIND=DPSIZE), POINTER ::D000009,D000010,D000011,D000012
      REAL(KIND=DPSIZE), POINTER ::D000013,D000014,D000015,D000016
      REAL(KIND=DPSIZE), POINTER ::D000017,D000018,D000019,D000020
      REAL(KIND=DPSIZE), POINTER ::D000021,D000022,D000023,D000024
      REAL(KIND=DPSIZE), POINTER ::D000025,D000026,D000027,D000028
      REAL(KIND=DPSIZE), POINTER ::D000029,D000030,D000031,D000032
      REAL(KIND=DPSIZE), POINTER ::D000033,D000034,D000035,D000036
      REAL(KIND=DPSIZE), POINTER ::D000037,D000038,D000039,D000040
      REAL(KIND=DPSIZE), POINTER ::D000041,D000042,D000043,D000044
      REAL(KIND=DPSIZE), POINTER ::D000045,D000046,D000047,D000048
      REAL(KIND=DPSIZE), POINTER ::D000049,D000050,D000051,D000052
      REAL(KIND=DPSIZE), POINTER ::D000053,D000054,D000055,D000056
      REAL(KIND=DPSIZE), POINTER ::D000057,D000058,D000059,D000060
      REAL(KIND=DPSIZE), POINTER ::D000061,D000062,D000063,D000064
      REAL(KIND=DPSIZE), POINTER ::D000065,D000066,D000067,D000068
      REAL(KIND=DPSIZE), POINTER ::D000069,D000070,D000071,D000072
      REAL(KIND=DPSIZE), POINTER ::D000073,D000074,D000075,D000076
      REAL(KIND=DPSIZE), POINTER ::D000077,D000138,D000137,D000136
      REAL(KIND=DPSIZE), POINTER ::D000135,D000134,D000133,D000132
      REAL(KIND=DPSIZE), POINTER ::D000131,D000130,D000129,D000128
      REAL(KIND=DPSIZE), POINTER ::D000152,D000167,D000190,D000189
      REAL(KIND=DPSIZE), POINTER ::D000188,D000187,D000186,D000185
      REAL(KIND=DPSIZE), POINTER ::D000184,D000183,D000182,D000181
      REAL(KIND=DPSIZE), POINTER ::D000180,C000053,D000191,C000054
      REAL(KIND=DPSIZE), POINTER ::D000192
      CONTAINS
      SUBROUTINE ASSOCNMPRD4
      COM=>VRBL
      nThin=>COM(000001);VWT=>COM(000002);MU_1=>COM(000003)
      MU_2=>COM(000004);MU_3=>COM(000005);MU_4=>COM(000006)
      MU_5=>COM(000007);MU_6=>COM(000008);MU_7=>COM(000009)
      MU_8=>COM(000010);MU_9=>COM(000011);MU_10=>COM(000012)
      MU_11=>COM(000013);CL=>COM(000014);Q=>COM(000015)
      V1=>COM(000016);V2=>COM(000017);KA=>COM(000018);MTT=>COM(000019)
      CIRC0=>COM(000020);ALPHA=>COM(000021);GAMMA=>COM(000022)
      SIG1=>COM(000023);SIG2=>COM(000024);K10=>COM(000025)
      K12=>COM(000026);K21=>COM(000027);KTR=>COM(000028)
      KPROL=>COM(000029);KCIRC=>COM(000030);S2=>COM(000031)
      S3=>COM(000032);CONC=>COM(000033);EDRUG=>COM(000034)
      IPRED=>COM(000035);IND=>COM(000036);YPK=>COM(000037)
      YPD=>COM(000038);Y=>COM(000039);A000098=>COM(000040)
      A000100=>COM(000041);A000103=>COM(000042);A000105=>COM(000043)
      A000106=>COM(000044);A000112=>COM(000045);A000111=>COM(000046)
      A000107=>COM(000047);A000117=>COM(000048);A000122=>COM(000049)
      A000128=>COM(000050);A000127=>COM(000051);A000123=>COM(000052)
      A000133=>COM(000053);A000138=>COM(000054);A000144=>COM(000055)
      A000143=>COM(000056);A000139=>COM(000057);A000149=>COM(000058)
      A000154=>COM(000059);A000159=>COM(000060);A000176=>COM(000061)
      A000177=>COM(000062);A000178=>COM(000063);A000179=>COM(000064)
      A000180=>COM(000065);A000181=>COM(000066);A000182=>COM(000067)
      A000183=>COM(000068);A000184=>COM(000069);A000185=>COM(000070)
      A000186=>COM(000071);A000187=>COM(000072);A000188=>COM(000073)
      A000189=>COM(000074);A000190=>COM(000075);A000191=>COM(000076)
      A000192=>COM(000077);A000193=>COM(000078);A000194=>COM(000079)
      A000195=>COM(000080);A000196=>COM(000081);A000197=>COM(000082)
      A000198=>COM(000083);A000199=>COM(000084);A000200=>COM(000085)
      A000201=>COM(000086);A000202=>COM(000087);A000203=>COM(000088)
      A000204=>COM(000089);A000205=>COM(000090);A000206=>COM(000091)
      A000207=>COM(000092);A000208=>COM(000093);A000209=>COM(000094)
      A000210=>COM(000095);E000010=>COM(000096);F000081=>COM(000097)
      E000012=>COM(000098);E000013=>COM(000099);E000014=>COM(000100)
      F000084=>COM(000101);F000086=>COM(000102);F000085=>COM(000103)
      F000087=>COM(000104);E000019=>COM(000105);E000020=>COM(000106)
      F000088=>COM(000107);F000089=>COM(000108);E000042=>COM(000109)
      E000044=>COM(000110);E000043=>COM(000111);F000129=>COM(000112)
      F000128=>COM(000113);F000131=>COM(000114);F000130=>COM(000115)
      F000127=>COM(000116);F000132=>COM(000117);E000111=>COM(000118)
      E000110=>COM(000119);F000191=>COM(000120);E000117=>COM(000121)
      E000116=>COM(000122);F000192=>COM(000123);E000123=>COM(000124)
      E000122=>COM(000125);F000193=>COM(000126);E000126=>COM(000127)
      E000127=>COM(000128);F000194=>COM(000129);F000195=>COM(000130)
      D000001=>COM(000131);D000002=>COM(000132);D000003=>COM(000133)
      D000004=>COM(000134);D000005=>COM(000135);D000006=>COM(000136)
      D000007=>COM(000137);D000008=>COM(000138);D000009=>COM(000139)
      D000010=>COM(000140);D000011=>COM(000141);D000012=>COM(000142)
      D000013=>COM(000143);D000014=>COM(000144);D000015=>COM(000145)
      D000016=>COM(000146);D000017=>COM(000147);D000018=>COM(000148)
      D000019=>COM(000149);D000020=>COM(000150);D000021=>COM(000151)
      D000022=>COM(000152);D000023=>COM(000153);D000024=>COM(000154)
      D000025=>COM(000155);D000026=>COM(000156);D000027=>COM(000157)
      D000028=>COM(000158);D000029=>COM(000159);D000030=>COM(000160)
      D000031=>COM(000161);D000032=>COM(000162);D000033=>COM(000163)
      D000034=>COM(000164);D000035=>COM(000165);D000036=>COM(000166)
      D000037=>COM(000167);D000038=>COM(000168);D000039=>COM(000169)
      D000040=>COM(000170);D000041=>COM(000171);D000042=>COM(000172)
      D000043=>COM(000173);D000044=>COM(000174);D000045=>COM(000175)
      D000046=>COM(000176);D000047=>COM(000177);D000048=>COM(000178)
      D000049=>COM(000179);D000050=>COM(000180);D000051=>COM(000181)
      D000052=>COM(000182);D000053=>COM(000183);D000054=>COM(000184)
      D000055=>COM(000185);D000056=>COM(000186);D000057=>COM(000187)
      D000058=>COM(000188);D000059=>COM(000189);D000060=>COM(000190)
      D000061=>COM(000191);D000062=>COM(000192);D000063=>COM(000193)
      D000064=>COM(000194);D000065=>COM(000195);D000066=>COM(000196)
      D000067=>COM(000197);D000068=>COM(000198);D000069=>COM(000199)
      D000070=>COM(000200);D000071=>COM(000201);D000072=>COM(000202)
      D000073=>COM(000203);D000074=>COM(000204);D000075=>COM(000205)
      D000076=>COM(000206);D000077=>COM(000207);D000138=>COM(000208)
      D000137=>COM(000209);D000136=>COM(000210);D000135=>COM(000211)
      D000134=>COM(000212);D000133=>COM(000213);D000132=>COM(000214)
      D000131=>COM(000215);D000130=>COM(000216);D000129=>COM(000217)
      D000128=>COM(000218);D000152=>COM(000219);D000167=>COM(000220)
      D000190=>COM(000221);D000189=>COM(000222);D000188=>COM(000223)
      D000187=>COM(000224);D000186=>COM(000225);D000185=>COM(000226)
      D000184=>COM(000227);D000183=>COM(000228);D000182=>COM(000229)
      D000181=>COM(000230);D000180=>COM(000231);C000053=>COM(000232)
      D000191=>COM(000233);C000054=>COM(000234);D000192=>COM(000235)
      END SUBROUTINE ASSOCNMPRD4
      END MODULE NMPRD4P
      MODULE DECLAREVARIABLES
      USE SIZES, ONLY: DPSIZE,ISIZE,NO
      SAVE
      INTEGER(KIND=ISIZE) :: FIRST_WRITE_PAR=0
      INTEGER(KIND=ISIZE) :: FIRST_WRITE_IPAR=0
      END MODULE DECLAREVARIABLES
      SUBROUTINE EXTRASEND()
      USE SIZES,        ONLY: ISIZE
      USE PROCM_INT, ONLY: NEWIND=>PNEWIF
      USE NMBAYES_INT, ONLY: BAYES_EXTRA,THINPRINT
      USE PNM_CONFIG, ONLY: PNM_RUN_MODE,PNM_MANAGER,PNM_WORKER,PNM_SINGLE,PNM_WORKER_COUNT,PNM_MPI_NODE,PNM_OFF
      IMPLICIT NONE
      INTEGER IBUFF(10),I,J
      IF(PNM_RUN_MODE==PNM_SINGLE) RETURN
      IF(NEWIND/=0) RETURN
      IF(PNM_RUN_MODE==PNM_MANAGER) THEN
        IBUFF(1)=BAYES_EXTRA
        IBUFF(2)=THINPRINT
        J=0
        DO I=1, PNM_WORKER_COUNT  ! For each worker dir...
          IF (PNM_OFF(I+1) == 1) CYCLE
          J=J+1
          PNM_MPI_NODE=J
          CALL PNM_MPI_SEND(IBUFF,2)
        ENDDO
      ELSE
        CALL PNM_MPI_RECV(IBUFF,2)
        BAYES_EXTRA=IBUFF(1)
        THINPRINT=IBUFF(2)
      ENDIF
      RETURN
      END

      SUBROUTINE MODEL (IDNO,NCM,NPAR,IR,IATT,LINK)                           
      USE PRMOD_CHAR, ONLY: NAME                                              
      USE SIZES,     ONLY: DPSIZE,ISIZE,SD
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      INTEGER(KIND=ISIZE) :: IDNO,NCM,NPAR,IR,IATT,LINK,I,J                   
      DIMENSION :: IATT(IR,*),LINK(IR,*)                                      
      SAVE
      INTEGER(KIND=ISIZE), DIMENSION (8,7) :: MOD
      CHARACTER(LEN=SD), DIMENSION(8) :: CMOD
      DATA (MOD(I,  1),I=  1,  8)/&
      1,1,1,1,1,1,1,1 /
      DATA (MOD(I,  2),I=  1,  8)/&
      1,1,1,1,1,1,1,1 /
      DATA (MOD(I,  3),I=  1,  8)/&
      1,1,1,1,1,1,1,1 /
      DATA (MOD(I,  4),I=  1,  8)/&
      1,0,0,0,0,0,0,0 /
      DATA (MOD(I,  5),I=  1,  8)/&
      1,0,0,0,0,0,0,0 /
      DATA (MOD(I,  6),I=  1,  8)/&
      0,0,0,0,0,0,0,0 /
      DATA (MOD(I,  7),I=  1,  8)/&
      0,0,0,0,0,0,0,0 /
      DATA (CMOD(I),I=  1,  8) &
      /'GUT','CENT','PERIPH','PROL','TRANS1','TRANS2','TRANS3','CIRC'/
      FORALL (I=1:8) NAME(I)=CMOD(I)
      FORALL (I=1:8,J=1:7) IATT(I,J)=MOD(I,J)
      IDNO=9999                                                               
      NCM=  8
      NPAR=011
      RETURN
      END
      SUBROUTINE PK(ICALL,IDEF,THETA,IREV,EVTREC,NVNT,INDXS,IRGG,GG,NETAS)      
      USE NMPRD4P
      USE DECLAREVARIABLES
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMBAYES_REAL,    ONLY: PRIORINFO
      USE PRDATA, ONLY: MXSTEP=>MXSTP01
      USE NMPRD_INT, ONLY: IERPRD,IERPRDU,NETEXT,IQUIT                        
      USE NMPRD_CHAR,ONLY: ETEXT                                              
      USE ROCM_REAL, ONLY: PR_Y
      USE ROCM_REAL, ONLY: PR_CT
      USE NMPRD_REAL,ONLY: ETA,EPS                                            
      USE NMPR_INT,  ONLY: RPTI=>NRPT_IN,RPTO=>NRPT_OUT,RPTON=>NRPT_ON,PRDFL=>IUSEPRD
      USE ROCM_INT,  ONLY: NREP,IREP=>NCREP
      USE ROCM_INT,  ONLY: MIXNUM=>MIXCALL,MIXEST=>IMIXEST                            
      USE ROCM_REAL, ONLY: MIXP                                                       
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE,NOFIRSTDERCODE
      USE NMPRD_REAL, ONLY: DV_LOQ,CDF_L,DV_LAQ,CDF_LA
      USE NMPR_REAL, ONLY: THSIMP=>THET_P,OMSIMP=>OMEG_P,SGSIMP=>SIGM_P,THSIMPR
      USE ROCM_REAL, ONLY: DEN_NP
      USE ROCM_REAL, ONLY: OMEGA=>VARNF
      USE ROCM_INT,  ONLY: NIREC=>NINDREC,NDREC=>NDATINDR
      USE ROCM_INT,  ONLY: NINDR=>NINDOBS,INDR1=>IDXOBSF,INDR2=>IDXOBSL
      USE ROCM_INT,  ONLY: LIREC=>NDATPASS
      USE NMPRD_INT, ONLY: NPROB,IPROB,IDXSUP,NITR_SUP,NITSUP
      USE NMPRD_INT, ONLY: NTHES_=>NWTHT,NETAS_=>NWETA,NEPSS_=>NWEPS
      USE NMPRD_INT, ONLY: COMACT,COMSAV
      USE ROCM_REAL, ONLY: IIDX=>DIDVALX
      USE ROCM_REAL, ONLY: CNTID=>OFV_IND
      USE CMNM1_INT, ONLY: NIND_7=>NIND
      USE PROCM_INT, ONLY: NEWIND=>PNEWIF                                       
      USE PROCM_REAL,ONLY: TSTATE
      USE PROCM_INT, ONLY: A_0FLG
      USE PROCM_REAL,ONLY: A=>AMNT,DAETA,D2AETA
      USE PRMOD_REAL,ONLY: A_0,DA_0,D2A_0
      USE PROCM_REAL,ONLY: DOSTIM,DDOST,D2DOST
      USE PROCM_REAL,ONLY: DOSREC
      USE PRMOD_INT, ONLY: I_SS,ISSNOW,ISSMOD
      USE NMBAYES_REAL, ONLY: LDF                                             
      USE PROCM_INT, ONLY: MNOW=>MTNOW,MPAST=>MTPAST,MNEXT=>MTNEXT      
      USE PKERR_REAL,ONLY: MTIME                                        
      USE PRMOD_INT, ONLY: MTDIFF                                             
      USE NMPRD_INT, ONLY: COMACT,COMSAV
      USE NMPRD_INT, ONLY: U06,U29,UST
      USE ROCM_REAL, ONLY: MIXPT=>MIXP_RAW
      USE NM_INTERFACE, ONLY: TFI
      USE NM_INTERFACE, ONLY: TFD
      USE NMPRD_INT, ONLY: MDV100
      USE NMPRD_INT, ONLY: MDVI1
      USE NMPRD_INT, ONLY: MDVI2
      USE NMPRD_INT, ONLY: MDVI3
      USE NMPRD_INT, ONLY: NTHETA
      USE NMPRD_INT, ONLY: NREC
      USE NMPRD_REAL, ONLY: DB
      USE NMPRD_REAL, ONLY: LB
      USE NMPRD_REAL, ONLY: UB
      USE CMNM1_INT, ONLY: NIND
      USE CMNM2_INT, ONLY: ICOMPRS
      USE CMNM2_REAL, ONLY: SPEC
      USE CMNM2_INT, ONLY: NOBSIND
      USE CMNM2_INT, ONLY: NRECIND
      USE ROCM_INT, ONLY: FIRSTREC
      USE ROCM_INT, ONLY: LASTREC
      USE ROCM_INT, ONLY: FIRSTOBS
      USE ROCM_INT, ONLY: LASTOBS
      USE ROCM_INT, ONLY: FIRSTDOS
      USE ROCM_INT, ONLY: LASTDOS
      USE ROCM_INT, ONLY: EFIRSTREC
      USE ROCM_INT, ONLY: ELASTREC
      USE ROCM_INT, ONLY: EFIRSTOBS
      USE ROCM_INT, ONLY: ELASTOBS
      USE ROCM_INT, ONLY: EFIRSTDOS
      USE ROCM_INT, ONLY: ELASTDOS
      USE CMNM2_INT ,ONLY: IRECIDX
      USE NMPRD_REAL, ONLY: EPS73
      USE NMPRD_REAL, ONLY: REPS
      USE NMPRD_REAL, ONLY: TOL
      USE NMPRD_REAL, ONLY: INFNTY
      USE NMPRD_REAL, ONLY: SQINFN
      USE CMNM7_REAL, ONLY: SREPS
      USE CMNM7_REAL, ONLY: STOL
      USE CMNM4_INT, ONLY: MAXDREC
      USE CMNM4_REAL, ONLY: SMALL
      USE VERSION, ONLY: LEV
      USE NMPRD_INT, ONLY: NPROB
      USE NMPRD_INT, ONLY: IPROB
      USE ROCM_REAL, ONLY: SIGD
      USE NMPRD_INT, ONLY: IPRNV
      USE NMPRD_INT, ONLY: IPS
      USE ROCM_INT, ONLY: NINDREC
      USE ROCM_INT, ONLY: NDATINDR
      USE ROCM_INT, ONLY: NINDOBS
      USE NMPRD_INT, ONLY: IDPROB
      USE CMNM2_INT, ONLY: NOBSIND_MAX
      USE NM_BAYES_INT, ONLY: ISEED
      USE NM_BAYES_INT, ONLY: IRANM
      USE NM_BAYES_REAL, ONLY: MEPS
      USE NMDATA, ONLY: PI
      USE NM_BAYES_INT, ONLY: IKEY_PITER
      USE NM_BAYES_INT, ONLY: IKEY_TERM
      USE NMBAYES_INT, ONLY: ITERATION
      USE NMBAYES_INT, ONLY: ITER_REPORT
      USE NMBAYES_INT, ONLY: NPAT
      USE NMBAYES_INT, ONLY: SAEM_MODE
      USE NMBAYES_INT, ONLY: ITS_MODE
      USE NMBAYES_INT, ONLY: IMP_MODE
      USE NMBAYES_INT, ONLY: PITERPRINT
      USE NMBAYES_REAL, ONLY: OBJI
      USE NMBAYES_CHAR, ONLY: SBANNER
      USE NMBAYES_INT, ONLY: IBMETHOD
      USE NMBAYES_INT, ONLY: BAYES_METHOD
      USE EST_DEFS, ONLY: EST_STANDARD
      USE EST_DEFS, ONLY: EST_DEFAULT
      USE EST_DEFS, ONLY: EST_DIRECT
      USE EST_DEFS, ONLY: EST_BAYES
      USE EST_DEFS, ONLY: EST_ITS
      USE EST_DEFS, ONLY: EST_IMP
      USE EST_DEFS, ONLY: EST_IMPMAP
      USE EST_DEFS, ONLY: EST_SAEM
      USE EST_DEFS, ONLY: EST_CHAIN
      USE NMBAYES_INT, ONLY: EST_COUNTER
      USE NMBAYES_INT, ONLY: IEST_COUNTER
      USE NMBAYES_REAL, ONLY: DHPRIOR
      USE NMBAYES_REAL, ONLY: LDF
      USE NMBAYES_INT, ONLY: ITABLE
      USE NMBAYES_INT, ONLY: BAYES_EXTRA_REQUEST
      USE NMBAYES_INT, ONLY: BAYES_EXTRA
      USE NMBAYES_INT, ONLY: PATCOUNT
      USE NMBAYES_INT, ONLY: CONSTRAIN
      USE NM_BAYES_INT, ONLY: IKEY_SUBJ
      USE NM_BAYES_INT, ONLY: IKEY_BEOPRINT
      USE PNM_CONFIG, ONLY: PNM_RUN_MODE
      USE PNM_CONFIG, ONLY: PNM_NODE_NUMBER
      USE PNM_CONFIG, ONLY: PNM_NODES
      USE PNM_CONFIG, ONLY: PNM_COMPUTERS
      USE PNM_CONFIG, ONLY: PNM_PARAPRINT
      USE PNM_CONFIG, ONLY: PNM_SPLIT
      USE PNM_CONFIG, ONLY: PNM_PARSE_NUMBER
      USE PNM_CONFIG, ONLY: PNM_TRANSFER_TYPE
      USE PNM_CONFIG, ONLY: PNM_TIMEOUTI
      USE PNM_CONFIG, ONLY: PNM_TIMEOUT
      USE PNM_CONFIG, ONLY: PNM_COMMAND
      USE PNM_CONFIG, ONLY: PNM_WORKER_DIRS
      USE PNM_CONFIG, ONLY: PNM_MTOUCH
      USE PNM_CONFIG, ONLY: PNM_MSLEEP
      USE PNM_CONFIG, ONLY: PNM_WTOUCH
      USE PNM_CONFIG, ONLY: PNM_WSLEEP
      USE NMBAYES_CHAR, ONLY: RANMETHOD
      USE NMBAYES_CHAR, ONLY: SRANMETHOD
      USE NMBAYES_CHAR, ONLY: TRANMETHOD
      USE NMBAYES_CHAR, ONLY: CRANMETHOD
      USE NMBAYES_CHAR, ONLY: CCRANMETHOD
      USE NMBAYES_INT, ONLY: ETASTYPE
      USE NMPRD_INT, ONLY: NETAZ
      USE NMPRD_INT, ONLY: NEPSZ
      USE NMBAYES_REAL, ONLY: OMEGANNL
      USE NM_BAYES_INT, ONLY: NM_STEP,BASE_STEP,EST_STEP,COV_STEP,TABLE_STEP,SIML_STEP,INE_STEP,&
&NONP_STEP
      USE NMBAYES_INT, ONLY: MUFIRSTREC
      USE NMBAYES_INT, ONLY: OBJQUICK
      USE CVIDAROOT, ONLY: NRTFN,NRTCT,RTINFO,RTSIGNAL,TRTINFO,YRTINFO,YPRTINFO,GRTINFO
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)                                          
      REAL(KIND=DPSIZE) :: EVTREC                                               
 991  FORMAT (35F14.4)
 992  FORMAT (35E15.7)
 998  FORMAT (1PE22.15,1X,1PE22.15/)
      SAVE
      INTEGER(KIND=ISIZE) :: FIRSTEM
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS              
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,GPKD+1,*) 
      INTEGER(KIND=ISIZE), POINTER :: S1NUM, S2NUM, S1NIT, S2NIT, S1IT, S2IT
      REAL(KIND=DPSIZE), POINTER :: DEN_,CDEN_(:)
! MIXPT=>MIXP_RAW:  Mixture probabilities for data-average block
! TFI:  function converts integer argument i to text: TFI(i)
! TFD:  function converts double precision argument d to text: TFD(d)
! MDV100: =0 if no MDV data itme, =1 if original MDV in data set is 0 or 1, =2 if original MDV in data set is 100 or 101
! MDVI1: DO not ignore MDV>100 records in OBJ routine
! MDVI2: DO not ignore MDV>100 records in OBJ2 routine
! MDVI3: DO not ignore MDV>100 records in OBJ3 routine
! NTHETA: Length of theta; may be set to 1 when length is 0
! DB: Upper bound minus lower bound (UB(I)-LB(I))
! LB: LB(I)=Lower bound for THETA(I)
! UB: UB(I)=Upper bound for THETA(I)
! NIND: Total number of individuals; set in INPT
! ICOMPRS: 0 = usual format for var-covar output, 1 = compressed format
! modified such that 0 = usual format, 9 or fewer elements, 1 = usual format more than 9 elements and 2 = compressed format
! SPEC:  = 1E10, used as a flag in var-covar
! NOBSIND: Number of observation records in individual record
! NRECIND: No. of records / this individual;
! NREC: No. of records in entire dataset;
! number of data records in individual record
! the following 12 items can be compared against NDREC
! FIRSTREC: first record of subject
! LASTREC: last record of subject
! FIRSTOBS: first observation record of subject (for which MDV=0 or 100)
! LASTOBS: last observation record of subject (for which MDV=0 or 100)
! FIRSTDOS: First record of subject with EVID=1 or EVID=4.  FIRSTDOS=-1 when there are no dose records, or PREDPP is not used.
! LASTDOS: Last record of subject with EVID=1 or EVID=4.  LASTDOS=-1 when there are no dose records, or PREDPP is not used.
! EFIRSTREC: first record of subject during estimation (so, among records for which MDV=0 or MDV=1)
! ELASTREC: last record of subject during estimation (so, among records for which MDV=0 or MDV=1)
! EFIRSTOBS: first observation record of subject  during estimation (so, among records for which MDV=0)
! ELASTOBS: last observation record of subject during estimation (so, among records for which MDV=0)
! EFIRSTDOS: First record of subject with EVID=1 or EVID=4 during estimation (so, among records for which MDV=1).  EFIRSTDOS=-1 if no dose record PREDPP is not
! ELASTDOS: Last record of subject with EVID=1 or EVID=4  during estimation (so, among records for which MDV=1).  ELASTDOS=-1 if no dose record PREDPP is not us
! IRECIDX: IRECIDX+1 is starting absolute record number in the data set for the present subject (so while NDREC always sets to 1 for the first record of each su
! During ICALL=1 (INFN initialization), ICALL=3 (INFN finalization), or ICALL=4 (simulation)
! only FIRSTREC and LASTREC are available.  The other values will be set to -1.
! EPS73: Mantissa length.  This is the number 2**(-m), where m is the number of binary digits occurring in the double precision mantissa.
! REPS: Same as REPST; Machine precision. Smallest double precision number that when added to 1 yields a number that is not 1 (same as MEPS)
! TOL: same as TOLT
! INFNTY: SQRT (LARGET); LARGET is largest double precision number representable by the machine
! SQINFN: SQRT (INFNTY)
! SREPS: same as SREPST
! STOL: same as STOLT
! MAXDREC: Maximum number of data record for an individual up to & including this individual
! SMALL: SQRT(TOL*REPS)
! LEV: Level of release
! NPROB: Number of problems
! IPROB: The number of the current problem
! SIGD: minimum value of significant digits; min(DIFA)
! IPRNV: 0 = no printing of NONMEM input info. after 1st iteration of active 1st(2nd) level super problem
! 1 = normal printing for active 1st (2nd) level super problem.
! IPS: Indicator variable,
! 1-> Population data,
! 2-> Single-subject data
! NINDREC (alias NIREC): The number of the individual record at current call (this the subject number)
! NDATINDR (alias NDREC): The number of the data record within the individual record at the current call
! NINDOBS: Number of individual records containing an observation record
! IDPROB: Problem ID
! NOBSIND_MAX: Maximum number of observations for any subject
! ISEED: Present seed number of ranmethods 0-3
! IRANM: Random method for Monte Carlo EM methods
! MEPS: Machine double precision (typically about 1.0E-15)
! PI: Contains the number PI
! IKEY_PITER: =1 to printer iterations, in response to ctrl-I, or signal file iter.sig
! IKEY_TERM: =5 to end run, in response to ctrl-E, or stop.sig file
! =11 to end mode, in response to ctrl-K, or next.sig file
! ITERATION: Present iteration of an EM/Bayesian Method (always non-negative).
! ITER_REPORT: Iteration number that is reported to output (can be negative, if during a burn period).
! NPAT: Number of subjects that have data
! SAEM_MODE: =0 Bayes method
! =1 Stochastic period of SAEM, IMP, ITS, DIRECT, IMPMAP
! =2 reduced stochastic/accumulative period of SAEM
! ITS_MODE: =0 no MAP estimation
! =1 MAP estimation on first iteration
! =2 MAP estimation all iterations (IMPMAP)
! =3 ITS
! IMP_MODE: =0 no Monte Carlo  importance sampling
! =1 Monte Carlo importance sampling
! PITERPRINT: =1 print iteration information
! =0 don’t print iteration information
! OBJI: OBJI(NIREC,1)= objective function value for subject NIREC
! SBANNER: Text to stimation method
! IBMETHOD: Holds METHOD type
! EST_* are defined in module EST_DEFS
! EST_STANDARD (FO/FOCE/LaPLCE)
! EST_DIRECT
! EST_BAYES
! EST_ITS
! EST_SAEM
! EST_IMP
! EST_IMPMAP
! EST_CHAIN
! BAYES_METHOD: ==0 FOR REGULAR BAYES, =1 FOR NUTS
! EST_COUNTER: Total number of $EST statements.
! IEST_COUNTER: Present $EST statement being executed.
! DHPRIOR: Prior portion for EM methods
! LDF: LDF(i)=Loss of degrees of freedom for omega i (usually=1)..  Used in correction for EM analyses only.
! ITABLE: Table number (#TBLN in NONMEM report file, and table numbers in extra output files, such as .ext, .phi, .phm, etc.)
! BAYES_EXTRA_REQUEST: See example8
! BAYES_EXTRA: See example8
! PATCOUNT: Number of subjects with data
! CONSTRAIN: CONSTRAIN setting by which CONSTRAINT routine responds
! IKEY_SUBJ: IF IKEY_SUBJ=20, then ctrl-T or subject.sig signal
! IKEY_BEOPRINT: Toggle to ctrl-B or sending paraprint.sig file.
! PNM_RUN_MODE: May have values:
! PNM_MANAGER
! PNM_WORKER
! PNM_SINGLE
! PNM_NODE_NUMBER: 1=MANAGER,  or SINGLE
! 2-PNM_NODES=WORKER
! PNM_NODES: Number of NODES
! PNM_COMPUTERS: COMPUTERS setting in pnm file
! PNM_PARAPRINT: PARAPRINT setting in pnm file
! PNM_SPLIT: PARSE_TYPE setting in pnm file
! PNM_PARSE_NUMBER: PARSE_NUM
! PNM_TRANSFER_TYPE: TRANSFER_TYPE
! PNM_TIMEOUTI: TIMEOUTI
! PNM_TIMEOUT: TIMEOUT
! PNM_COMMAND: Array pnm commands
! PNM_WORKER_DIRS: Array with worker directories (1-nodes-1)
! PNM_MTOUCH: MTOUCH
! PNM_MSLEEP: MSLEEP
! PNM_WTOUCH: WTOUCH
! PNM_WSLEEP: WSLEEP
! RANMETHOD: $EST RANMETHOD
! SRANMETHOD: $SIML RANMETHOD
! TRANMETHOD: $TABLE RANMETHOD
! CRANMETHOD: $EST METHOD=CHAIN RANMETHOD
! CCRANMETHOD: $CHAIN RANMETHOD
! ETASTYPE: ETASTYPE
! NETAZ: Maximum eta index to have non-zero OMEGA diagonal
! NEPSZ: Maximum eps index to have non-zero SIGMA diagonal
! OMEGANNL: For each x,y in
! $ANNEAL x:y
! OMEGANNL(x)=y
! Those not defined in $ANNEAL are set to -1
! Used in CONSTRAINT.f90
! NM_STEP CAN HAVE THE FOLLOWING VALUES: BASE_STEP, EST_STEP,COV_STEP,TABLE_STEP,SIML_STEP,INE_STEP,NONP_STEP
! MUFIRSTREC: SET TO 1 IN $PK OR $PRED TO CAUSE COVARIATES OF ONLY FIRST RECORD OF SUBJECT TO BE USED IN ASSESSING MU
! OBJQUICK: SET TO 1 IN $PRED OR $PK TO USE QUICK CODE FOR NOUTURN SAMPLING.  ONLY SIMPLE MODELS, WITH NO $MIX, OR $LEVEL
! CVIDAROOT USED FOR ADVAN14 (SEE CVODEU.F90 COMMENTS), OR ADVAN15 (SEE IDAU.F90 COMMENTS) FOR ROOT FINDING
      S1NUM=>IDXSUP(1)
      S2NUM=>IDXSUP(2)
      S1NIT=>NITR_SUP(1)
      S2NIT=>NITR_SUP(2)
      S1IT=>NITSUP(1)
      S2IT=>NITSUP(2)
      DEN_=>DEN_NP(1)
      CDEN_=>DEN_NP(2:)
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN                                                      
      CALL ASSOCNMPRD4
      IDEF(   1,0001)=  -9
      IDEF(   1,0002)=  -1
      IDEF(   1,0003)=   1
      IDEF(   1,0004)=   0
      IDEF(   2,0003)=   0
      IDEF(   2,0004)=   0
      IDEF(   3,0002)=  12
      IDEF(   3,0003)=  13
      CALL GETETA(ETA)                                                          
      IF (IQUIT == 1) RETURN                                                    
      RETURN                                                                    
      ENDIF                                                                     
      IF (NEWIND /= 2) THEN
      IF (ICALL == 4) THEN
      CALL SIMETA(ETA)
      ELSE
      CALL GETETA(ETA)
      ENDIF
      IF (IQUIT == 1) RETURN
      ENDIF
 !  level            0
      WT=EVTREC(NVNT,009)
      BAYES_EXTRA_REQUEST=1.D0 
      nThin=THETA(012) 
      B000001=WT/70.D0 
      B000002=DLOG(B000001) 
      VWT=B000002 
      MU_1=THETA(001)+0.75D0*VWT 
      MU_2=THETA(002)+0.75D0*VWT 
      MU_3=THETA(003)+VWT 
      MU_4=THETA(004)+VWT 
      MU_5=THETA(005) 
      MU_6=THETA(006) 
      MU_7=THETA(007) 
      MU_8=THETA(008) 
      MU_9=THETA(009) 
      MU_10=THETA(010) 
      MU_11=THETA(011) 
      CALL EXTRASEND()
      B000003=MU_1+ETA(001) 
      B000004=DEXP(B000003) 
      CL=B000004 
      B000005=MU_2+ETA(002) 
      B000006=DEXP(B000005) 
      Q=B000006 
      B000007=MU_3+ETA(003) 
      B000008=DEXP(B000007) 
      V1=B000008 
      B000009=MU_4+ETA(004) 
      B000010=DEXP(B000009) 
      V2=B000010 
      B000011=MU_5+ETA(005) 
      B000012=DEXP(B000011) 
      KA=B000012 
      B000013=MU_6+ETA(006) 
      B000014=DEXP(B000013) 
      MTT=B000014 
      B000015=MU_7+ETA(007) 
      B000016=DEXP(B000015) 
      CIRC0=B000016 
      B000017=MU_8+ETA(008) 
      B000018=DEXP(B000017) 
      ALPHA=B000018 
      B000019=MU_9+ETA(009) 
      B000020=DEXP(B000019) 
      GAMMA=B000020 
      B000021=MU_10+ETA(010) 
      B000022=DEXP(B000021) 
      SIG1=B000022 
      B000023=MU_11+ETA(011) 
      B000024=DEXP(B000023) 
      SIG2=B000024 
      K10=CL/V1 
      K12=Q/V1 
      K21=Q/V2 
      KTR=4.D0/MTT 
      KPROL=KTR 
      KCIRC=KTR 
      IF(A_0FLG == 1)THEN 
      A_0(1)=0.D0 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      A_0(2)=0.D0 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      A_0(3)=0.D0 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      A_0(4)=CIRC0 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      A_0(5)=CIRC0 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      A_0(6)=CIRC0 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      A_0(7)=CIRC0 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      A_0(8)=CIRC0 
      ENDIF 
      S2=V1 
      S3=V2 
      B000053=ITER_REPORT/nThin 
      B000055=ITER_REPORT/nThin 
      B000054=INT(B000055) 
      IF(BAYES_EXTRA == 1.D0.AND.NIREC == 1.D0.AND.NDREC == 1.D0.AND. &
      ITER_REPORT >  0.D0.AND.B000053 == B000054)THEN 
      IF(FIRST_WRITE_PAR == 0)THEN 
      OPEN(unit=52,FILE='./par.txt')
      FIRST_WRITE_PAR=1 
      ENDIF 
      WRITE(52,'(I12,1X,50(1X,1PG19.10E3))') ITER_REPORT, &
      THETA(1), THETA(2), THETA(3), THETA(4), THETA(5), THETA(6), THETA(7), &
      THETA(8), THETA(9), THETA(10), THETA(11), &
      OMEGA(1,1), OMEGA(2,1), OMEGA(2,2), &
      OMEGA(3,1), OMEGA(3,2), OMEGA(3,3), &
      OMEGA(4,1), OMEGA(4,2), OMEGA(4,3), OMEGA(4,4), &
      OMEGA(5,1), OMEGA(5,2), OMEGA(5,3), OMEGA(5,4), OMEGA(5,5), &
      OMEGA(6,1), OMEGA(6,2), OMEGA(6,3), OMEGA(6,4), OMEGA(6,5), OMEGA(6,6), &
      OMEGA(7,1), OMEGA(7,2), OMEGA(7,3), OMEGA(7,4), OMEGA(7,5), OMEGA(7,6), OMEGA(7,7), &
      OMEGA(8,1), OMEGA(8,2), OMEGA(8,3), OMEGA(8,4), OMEGA(8,5), OMEGA(8,6), OMEGA(8,7), OMEGA(8,8&
&)
      ENDIF 
      B000067=ITER_REPORT/nThin 
      B000069=ITER_REPORT/nThin 
      B000068=INT(B000069) 
      IF(BAYES_EXTRA == 1.D0.AND.NDREC == 1.D0.AND.ITER_REPORT >  0.D0 &
      .AND.B000067 == B000068)THEN 
      IF(FIRST_WRITE_IPAR == 0)THEN 
      OPEN(unit=50,FILE='./ipar'//TFI(PNM_NODE_NUMBER)//'.txt')
      FIRST_WRITE_IPAR=1 
      ENDIF 
      WRITE(50,'(I12,1X,F14.0,13(1X,1PG12.5))') ITER_REPORT, EVTREC(NVNT,002), &
      ETA(1), ETA(2), ETA(3), ETA(4), ETA(5), ETA(6), ETA(7), ETA(8)
      ENDIF 
      P000001=KA 
      P000002=K10 
      P000003=K12 
      P000004=K21 
      P000005=V1 
      P000006=ALPHA 
      P000007=CIRC0 
      P000008=GAMMA 
      P000009=KPROL 
      P000010=KTR 
      P000011=KCIRC 
      IF (FIRSTEM == 1) THEN
!                      A000098 = DERIVATIVE OF SIG1 W.R.T. ETA(010)
      A000098=B000022 
!                      A000103 = DERIVATIVE OF SIG2 W.R.T. ETA(011)
      A000103=B000024 
      B000025=1.D0/V1 
!                      A000106 = DERIVATIVE OF K10 W.R.T. ETA(001)
      A000106=B000025*B000004 
      B000026=-CL/V1/V1 
!                      A000107 = DERIVATIVE OF K10 W.R.T. ETA(003)
      A000107=B000026*B000008 
      B000033=1.D0/V1 
!                      A000122 = DERIVATIVE OF K12 W.R.T. ETA(002)
      A000122=B000033*B000006 
      B000034=-Q/V1/V1 
!                      A000123 = DERIVATIVE OF K12 W.R.T. ETA(003)
      A000123=B000034*B000008 
      B000041=1.D0/V2 
!                      A000138 = DERIVATIVE OF K21 W.R.T. ETA(002)
      A000138=B000041*B000006 
      B000042=-Q/V2/V2 
!                      A000139 = DERIVATIVE OF K21 W.R.T. ETA(004)
      A000139=B000042*B000010 
      B000049=-4.D0/MTT/MTT 
!                      A000154 = DERIVATIVE OF KTR W.R.T. ETA(006)
      A000154=B000049*B000014 
      IF(A_0FLG == 1)THEN 
      DA_0(004,007)=B000016 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      DA_0(005,007)=B000016 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      DA_0(006,007)=B000016 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      DA_0(007,007)=B000016 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      DA_0(008,007)=B000016 
      ENDIF 
!                      A000176 = DERIVATIVE OF S2 W.R.T. ETA(003)
      A000176=B000008 
!                      A000178 = DERIVATIVE OF S3 W.R.T. ETA(004)
      A000178=B000010 
!                      A000180 = DERIVATIVE OF P000001 W.R.T. ETA(005)
      A000180=B000012 
!                      A000182 = DERIVATIVE OF P000002 W.R.T. ETA(003)
      A000182=A000107 
!                      A000183 = DERIVATIVE OF P000002 W.R.T. ETA(001)
      A000183=A000106 
!                      A000187 = DERIVATIVE OF P000003 W.R.T. ETA(003)
      A000187=A000123 
!                      A000188 = DERIVATIVE OF P000003 W.R.T. ETA(002)
      A000188=A000122 
!                      A000192 = DERIVATIVE OF P000004 W.R.T. ETA(004)
      A000192=A000139 
!                      A000193 = DERIVATIVE OF P000004 W.R.T. ETA(002)
      A000193=A000138 
!                      A000197 = DERIVATIVE OF P000005 W.R.T. ETA(003)
      A000197=B000008 
!                      A000199 = DERIVATIVE OF P000006 W.R.T. ETA(008)
      A000199=B000018 
!                      A000201 = DERIVATIVE OF P000007 W.R.T. ETA(007)
      A000201=B000016 
!                      A000203 = DERIVATIVE OF P000008 W.R.T. ETA(009)
      A000203=B000020 
!                      A000205 = DERIVATIVE OF P000009 W.R.T. ETA(006)
      A000205=A000154 
!                      A000207 = DERIVATIVE OF P000010 W.R.T. ETA(006)
      A000207=A000154 
!                      A000209 = DERIVATIVE OF P000011 W.R.T. ETA(006)
      A000209=A000154 
      GG(0001,1,1)=P000001
      GG(0001,0006,1)=A000180
      GG(0002,1,1)=P000002
      GG(0002,0002,1)=A000183
      GG(0002,0004,1)=A000182
      GG(0003,1,1)=P000003
      GG(0003,0003,1)=A000188
      GG(0003,0004,1)=A000187
      GG(0004,1,1)=P000004
      GG(0004,0003,1)=A000193
      GG(0004,0005,1)=A000192
      GG(0005,1,1)=P000005
      GG(0005,0004,1)=A000197
      GG(0006,1,1)=P000006
      GG(0006,0009,1)=A000199
      GG(0007,1,1)=P000007
      GG(0007,0008,1)=A000201
      GG(0008,1,1)=P000008
      GG(0008,0010,1)=A000203
      GG(0009,1,1)=P000009
      GG(0009,0007,1)=A000205
      GG(0010,1,1)=P000010
      GG(0010,0007,1)=A000207
      GG(0011,1,1)=P000011
      GG(0011,0007,1)=A000209
      GG(0012,1,1)=S2
      GG(0012,0004,1)=A000176
      GG(0013,1,1)=S3
      GG(0013,0005,1)=A000178
      ELSE
      GG(0001,1,1)=P000001
      GG(0002,1,1)=P000002
      GG(0003,1,1)=P000003
      GG(0004,1,1)=P000004
      GG(0005,1,1)=P000005
      GG(0006,1,1)=P000006
      GG(0007,1,1)=P000007
      GG(0008,1,1)=P000008
      GG(0009,1,1)=P000009
      GG(0010,1,1)=P000010
      GG(0011,1,1)=P000011
      GG(0012,1,1)=S2
      GG(0013,1,1)=S3
      ENDIF
      IF (MSEC == 1) THEN
!                      A000100 = DERIVATIVE OF A000098 W.R.T. ETA(010)
      A000100=B000022 
!                      A000105 = DERIVATIVE OF A000103 W.R.T. ETA(011)
      A000105=B000024 
      B000029=-1.D0/V1/V1 
!                      A000110 = DERIVATIVE OF B000025 W.R.T. ETA(003)
      A000110=B000029*B000008 
!                      A000111 = DERIVATIVE OF A000106 W.R.T. ETA(003)
      A000111=B000004*A000110 
!                      A000112 = DERIVATIVE OF A000106 W.R.T. ETA(001)
      A000112=B000025*B000004 
      B000030=-1.D0/V1/V1 
!                      A000113 = DERIVATIVE OF B000026 W.R.T. ETA(001)
      A000113=B000030*B000004 
      B000031=CL/V1/V1/V1 
!                      A000114 = DERIVATIVE OF B000026 W.R.T. ETA(003)
      A000114=B000031*B000008 
      B000032=CL/V1/V1/V1 
!                      A000115 = DERIVATIVE OF B000026 W.R.T. ETA(003)
      A000115=B000032*B000008+A000114 
!                      A000116 = DERIVATIVE OF A000107 W.R.T. ETA(003)
      A000116=B000008*A000115 
!                      A000117 = DERIVATIVE OF A000107 W.R.T. ETA(003)
      A000117=B000026*B000008+A000116 
      B000037=-1.D0/V1/V1 
!                      A000126 = DERIVATIVE OF B000033 W.R.T. ETA(003)
      A000126=B000037*B000008 
!                      A000127 = DERIVATIVE OF A000122 W.R.T. ETA(003)
      A000127=B000006*A000126 
!                      A000128 = DERIVATIVE OF A000122 W.R.T. ETA(002)
      A000128=B000033*B000006 
      B000038=-1.D0/V1/V1 
!                      A000129 = DERIVATIVE OF B000034 W.R.T. ETA(002)
      A000129=B000038*B000006 
      B000039=Q/V1/V1/V1 
!                      A000130 = DERIVATIVE OF B000034 W.R.T. ETA(003)
      A000130=B000039*B000008 
      B000040=Q/V1/V1/V1 
!                      A000131 = DERIVATIVE OF B000034 W.R.T. ETA(003)
      A000131=B000040*B000008+A000130 
!                      A000132 = DERIVATIVE OF A000123 W.R.T. ETA(003)
      A000132=B000008*A000131 
!                      A000133 = DERIVATIVE OF A000123 W.R.T. ETA(003)
      A000133=B000034*B000008+A000132 
      B000045=-1.D0/V2/V2 
!                      A000142 = DERIVATIVE OF B000041 W.R.T. ETA(004)
      A000142=B000045*B000010 
!                      A000143 = DERIVATIVE OF A000138 W.R.T. ETA(004)
      A000143=B000006*A000142 
!                      A000144 = DERIVATIVE OF A000138 W.R.T. ETA(002)
      A000144=B000041*B000006 
      B000046=-1.D0/V2/V2 
!                      A000145 = DERIVATIVE OF B000042 W.R.T. ETA(002)
      A000145=B000046*B000006 
      B000047=Q/V2/V2/V2 
!                      A000146 = DERIVATIVE OF B000042 W.R.T. ETA(004)
      A000146=B000047*B000010 
      B000048=Q/V2/V2/V2 
!                      A000147 = DERIVATIVE OF B000042 W.R.T. ETA(004)
      A000147=B000048*B000010+A000146 
!                      A000148 = DERIVATIVE OF A000139 W.R.T. ETA(004)
      A000148=B000010*A000147 
!                      A000149 = DERIVATIVE OF A000139 W.R.T. ETA(004)
      A000149=B000042*B000010+A000148 
      B000051=4.D0/MTT/MTT/MTT 
!                      A000156 = DERIVATIVE OF B000049 W.R.T. ETA(006)
      A000156=B000051*B000014 
      B000052=4.D0/MTT/MTT/MTT 
!                      A000157 = DERIVATIVE OF B000049 W.R.T. ETA(006)
      A000157=B000052*B000014+A000156 
!                      A000158 = DERIVATIVE OF A000154 W.R.T. ETA(006)
      A000158=B000014*A000157 
!                      A000159 = DERIVATIVE OF A000154 W.R.T. ETA(006)
      A000159=B000049*B000014+A000158 
      IF(A_0FLG == 1)THEN 
      D2A_0(004,007,007)=B000016 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      D2A_0(005,007,007)=B000016 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      D2A_0(006,007,007)=B000016 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      D2A_0(007,007,007)=B000016 
      ENDIF 
      IF(A_0FLG == 1)THEN 
      D2A_0(008,007,007)=B000016 
      ENDIF 
!                      A000177 = DERIVATIVE OF A000176 W.R.T. ETA(003)
      A000177=B000008 
!                      A000179 = DERIVATIVE OF A000178 W.R.T. ETA(004)
      A000179=B000010 
!                      A000181 = DERIVATIVE OF A000180 W.R.T. ETA(005)
      A000181=B000012 
!                      A000184 = DERIVATIVE OF A000182 W.R.T. ETA(003)
      A000184=A000117 
!                      A000185 = DERIVATIVE OF A000183 W.R.T. ETA(001)
      A000185=A000112 
!                      A000186 = DERIVATIVE OF A000183 W.R.T. ETA(003)
      A000186=A000111 
!                      A000189 = DERIVATIVE OF A000187 W.R.T. ETA(003)
      A000189=A000133 
!                      A000190 = DERIVATIVE OF A000188 W.R.T. ETA(002)
      A000190=A000128 
!                      A000191 = DERIVATIVE OF A000188 W.R.T. ETA(003)
      A000191=A000127 
!                      A000194 = DERIVATIVE OF A000192 W.R.T. ETA(004)
      A000194=A000149 
!                      A000195 = DERIVATIVE OF A000193 W.R.T. ETA(002)
      A000195=A000144 
!                      A000196 = DERIVATIVE OF A000193 W.R.T. ETA(004)
      A000196=A000143 
!                      A000198 = DERIVATIVE OF A000197 W.R.T. ETA(003)
      A000198=B000008 
!                      A000200 = DERIVATIVE OF A000199 W.R.T. ETA(008)
      A000200=B000018 
!                      A000202 = DERIVATIVE OF A000201 W.R.T. ETA(007)
      A000202=B000016 
!                      A000204 = DERIVATIVE OF A000203 W.R.T. ETA(009)
      A000204=B000020 
!                      A000206 = DERIVATIVE OF A000205 W.R.T. ETA(006)
      A000206=A000159 
!                      A000208 = DERIVATIVE OF A000207 W.R.T. ETA(006)
      A000208=A000159 
!                      A000210 = DERIVATIVE OF A000209 W.R.T. ETA(006)
      A000210=A000159 
      GG(0001,0006,0006)=A000181
      GG(0002,0002,0002)=A000185
      GG(0002,0004,0002)=A000186
      GG(0002,0004,0004)=A000184
      GG(0003,0003,0003)=A000190
      GG(0003,0004,0003)=A000191
      GG(0003,0004,0004)=A000189
      GG(0004,0003,0003)=A000195
      GG(0004,0005,0003)=A000196
      GG(0004,0005,0005)=A000194
      GG(0005,0004,0004)=A000198
      GG(0006,0009,0009)=A000200
      GG(0007,0008,0008)=A000202
      GG(0008,0010,0010)=A000204
      GG(0009,0007,0007)=A000206
      GG(0010,0007,0007)=A000208
      GG(0011,0007,0007)=A000210
      GG(0012,0004,0004)=A000177
      GG(0013,0005,0005)=A000179
      ENDIF
      RETURN
      END
      SUBROUTINE ERROR (ICALL,IDEF,THETA,IREV,EVTREC,NVNT,INDXS,F,G,HH)       
      USE NMPRD4P
      USE DECLAREVARIABLES
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMPRD_REAL,ONLY: ETA,EPS                                            
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,IQUIT,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE,NOFIRSTDERCODE
      USE NMPRD_REAL, ONLY: DV_LOQ,CDF_L,DV_LAQ,CDF_LA
      USE NMPRD_INT, ONLY: NEWL2
      USE PROCM_INT, ONLY: NEWIND=>PNEWIF                                       
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)                                        
      REAL(KIND=DPSIZE) :: EVTREC                                             
      SAVE
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS                       
      DIMENSION :: IDEF(*),THETA(*),EVTREC(IREV,*),INDXS(*)                   
      REAL(KIND=DPSIZE) :: G(GERD,*),HH(HERD,*)                               
      INTEGER(KIND=ISIZE) :: FIRSTEM
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN                                                    
      CALL ASSOCNMPRD4
      IDEF(2)=0
      IDEF(3)=000
      RETURN
      ENDIF
      IF (ICALL == 4) THEN
      IF (NEWL2 == 1) THEN
      CALL SIMEPS(EPS)
      IF (IQUIT == 1) RETURN
      ENDIF
      ENDIF
      D000001=G(001,1)
      D000002=G(002,1)
      D000003=G(003,1)
      D000004=G(004,1)
      D000005=G(005,1)
      D000006=G(006,1)
      D000007=G(007,1)
      D000008=G(008,1)
      D000009=G(009,1)
      D000010=G(010,1)
      D000011=G(011,1)
 !  level            0
      DVID=EVTREC(NVNT,010)
      IPRED=DLOG(F) 
      IND=0.D0 
      IF(DVID == 2.D0)THEN 
      IND=1.D0 
      ENDIF 
      YPK=IPRED+SIG1*EPS(001) 
      YPD=IPRED+SIG2*EPS(002) 
      B000005=1.D0-IND 
      Y=YPK*IND+YPD*B000005 
      B000006=IND 
!                      C000053 = DERIVATIVE OF Y W.R.T. EPS(001)
      C000053=IND*SIG1 
!                      C000054 = DERIVATIVE OF Y W.R.T. EPS(002)
      C000054=B000005*SIG2 
      B000007=IND 
      IF (FIRSTEM == 1) THEN !1
      B000001=1.D0/F 
!                      D000128 = DERIVATIVE OF IPRED W.R.T. ETA(011)
      D000128=B000001*D000011 
!                      D000129 = DERIVATIVE OF IPRED W.R.T. ETA(010)
      D000129=B000001*D000010 
!                      D000130 = DERIVATIVE OF IPRED W.R.T. ETA(009)
      D000130=B000001*D000009 
!                      D000131 = DERIVATIVE OF IPRED W.R.T. ETA(008)
      D000131=B000001*D000008 
!                      D000132 = DERIVATIVE OF IPRED W.R.T. ETA(007)
      D000132=B000001*D000007 
!                      D000133 = DERIVATIVE OF IPRED W.R.T. ETA(006)
      D000133=B000001*D000006 
!                      D000134 = DERIVATIVE OF IPRED W.R.T. ETA(005)
      D000134=B000001*D000005 
!                      D000135 = DERIVATIVE OF IPRED W.R.T. ETA(004)
      D000135=B000001*D000004 
!                      D000136 = DERIVATIVE OF IPRED W.R.T. ETA(003)
      D000136=B000001*D000003 
!                      D000137 = DERIVATIVE OF IPRED W.R.T. ETA(002)
      D000137=B000001*D000002 
!                      D000138 = DERIVATIVE OF IPRED W.R.T. ETA(001)
      D000138=B000001*D000001 
!                      D000152 = DERIVATIVE OF YPK W.R.T. ETA(010)
      D000152=EPS(001)*A000098+D000129 
!                      D000167 = DERIVATIVE OF YPD W.R.T. ETA(011)
      D000167=EPS(002)*A000103+D000128 
!                      D000169 = DERIVATIVE OF Y W.R.T. ETA(010)
      D000169=B000006*D000152 
!                      D000170 = DERIVATIVE OF Y W.R.T. ETA(011)
      D000170=B000006*D000128 
!                      D000171 = DERIVATIVE OF Y W.R.T. ETA(009)
      D000171=B000006*D000130 
!                      D000172 = DERIVATIVE OF Y W.R.T. ETA(008)
      D000172=B000006*D000131 
!                      D000173 = DERIVATIVE OF Y W.R.T. ETA(007)
      D000173=B000006*D000132 
!                      D000174 = DERIVATIVE OF Y W.R.T. ETA(006)
      D000174=B000006*D000133 
!                      D000175 = DERIVATIVE OF Y W.R.T. ETA(005)
      D000175=B000006*D000134 
!                      D000176 = DERIVATIVE OF Y W.R.T. ETA(004)
      D000176=B000006*D000135 
!                      D000177 = DERIVATIVE OF Y W.R.T. ETA(003)
      D000177=B000006*D000136 
!                      D000178 = DERIVATIVE OF Y W.R.T. ETA(002)
      D000178=B000006*D000137 
!                      D000179 = DERIVATIVE OF Y W.R.T. ETA(001)
      D000179=B000006*D000138 
!                      D000180 = DERIVATIVE OF Y W.R.T. ETA(011)
      D000180=B000005*D000167+D000170 
!                      D000181 = DERIVATIVE OF Y W.R.T. ETA(010)
      D000181=B000005*D000129+D000169 
!                      D000182 = DERIVATIVE OF Y W.R.T. ETA(009)
      D000182=B000005*D000130+D000171 
!                      D000183 = DERIVATIVE OF Y W.R.T. ETA(008)
      D000183=B000005*D000131+D000172 
!                      D000184 = DERIVATIVE OF Y W.R.T. ETA(007)
      D000184=B000005*D000132+D000173 
!                      D000185 = DERIVATIVE OF Y W.R.T. ETA(006)
      D000185=B000005*D000133+D000174 
!                      D000186 = DERIVATIVE OF Y W.R.T. ETA(005)
      D000186=B000005*D000134+D000175 
!                      D000187 = DERIVATIVE OF Y W.R.T. ETA(004)
      D000187=B000005*D000135+D000176 
!                      D000188 = DERIVATIVE OF Y W.R.T. ETA(003)
      D000188=B000005*D000136+D000177 
!                      D000189 = DERIVATIVE OF Y W.R.T. ETA(002)
      D000189=B000005*D000137+D000178 
!                      D000190 = DERIVATIVE OF Y W.R.T. ETA(001)
      D000190=B000005*D000138+D000179 
!                      D000191 = DERIVATIVE OF C000053 W.R.T. ETA(010)
      D000191=B000007*A000098 
!                      D000192 = DERIVATIVE OF C000054 W.R.T. ETA(011)
      D000192=B000005*A000103 
      G(001,1)=D000190
      G(002,1)=D000189
      G(003,1)=D000188
      G(004,1)=D000187
      G(005,1)=D000186
      G(006,1)=D000185
      G(007,1)=D000184
      G(008,1)=D000183
      G(009,1)=D000182
      G(010,1)=D000181
      G(011,1)=D000180
      ENDIF !1
      HH(001,1)=C000053
      HH(002,1)=C000054
      IF (FIRSTEM == 1) THEN !2
      HH(001,011)=D000191
      HH(002,012)=D000192
      ENDIF !2
      F=Y
      RETURN
      END
      SUBROUTINE TOL(NRD,ANRD,NRDC,ANRDC)
      USE SIZES,     ONLY: ISIZE
      INTEGER(KIND=ISIZE) :: NRD(0:*), ANRD(0:*), NRDC(0:*), ANRDC(0:*)
      NRD(1)=6 
      RETURN
      END
      SUBROUTINE DES (A,P,T,DADT,IR,DA,DP,DT)                                 
      USE NMPRD4P
      USE DECLAREVARIABLES
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMPRD_INT, ONLY: IERPRD,IERPRDU,NETEXT,IQUIT                        
      USE NMPRD_CHAR,ONLY: ETEXT                                              
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,IFIRSTEM,IFIRSTEMJAC
      USE PRCOM_INT, ONLY: MITER
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE,NOFIRSTDERCODE
      USE NMPRD_REAL, ONLY: DV_LOQ,CDF_L,DV_LAQ,CDF_LA
      USE PRMOD_INT, ONLY: ICALL=>ICALLD,IDEFD,IDEFA
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)                                        
      SAVE
      INTEGER(KIND=ISIZE) :: IR                                               
      DIMENSION :: A(*),P(*),DADT(*),DA(IR,*),DP(IR,*),DT(*)                  
      INTEGER(KIND=ISIZE) :: FIRSTEM,IFIRSTEMJACIN
      IF(MITER==1.OR.MITER==4) IFIRSTEM=1
      FIRSTEM=IFIRSTEM
      IFIRSTEMJACIN=IFIRSTEMJAC
      IF(NOFIRSTDERCODE/=1) THEN
      IFIRSTEMJAC=FIRSTEM
      ELSE
      IFIRSTEMJAC=0
      ENDIF
      IF(IFIRSTEMJACIN==-2) RETURN
      IF (ICALL == 1) THEN
      CALL ASSOCNMPRD4
      IDEFD(1)=  0
      IDEFD(2)=0
      DA(   1,1)=0000014280
      DA(   2,1)=0000028441
      DA(   3,1)=0000028560
      DA(   4,1)=0000028679
      DA(   5,1)=0000042721
      DA(   6,1)=0000042840
      DA(   7,1)=0000056882
      DA(   8,1)=0000057120
      DA(   9,1)=0000057596
      DA(  10,1)=0000071281
      DA(  11,1)=0000071400
      DA(  12,1)=0000085561
      DA(  13,1)=0000085680
      DA(  14,1)=0000099841
      DA(  15,1)=0000099960
      DA(  16,1)=0000114121
      DA(  17,1)=0000114240
      DA(  18,1)=0000057122
      DA(  19,1)=0000057598
      DA(  20,1)=0000056886
      DA(  21,1)=0000057600
      DA(  22,1)=0000056890
      DA(  23,1)=0000057128
      DA(  24,1)=0000057604
      DA(  25,1)=0000014311
      DA(  26,1)=0000028472
      DA(  27,1)=0000028592
      DA(  28,1)=0000028593
      DA(  29,1)=0000042754
      DA(  30,1)=0000056917
      DA(  31,1)=0000056919
      DA(  32,1)=0000056920
      DA(  33,1)=0000056921
      DA(  34,1)=0000028713
      DA(  35,1)=0000042874
      DA(  36,1)=0000057155
      DA(  37,1)=0000057156
      DA(  38,1)=0000057157
      DA(  39,1)=0000057158
      DA(  40,1)=0000057159
      DA(  41,1)=0000057160
      DA(  42,1)=0000071321
      DA(  43,1)=0000071440
      DA(  44,1)=0000085601
      DA(  45,1)=0000085720
      DA(  46,1)=0000099881
      DA(  47,1)=0000100000
      DA(  48,1)=0000114161
      DA(  49,1)=0000057631
      DA(  50,1)=0000057632
      DA(  51,1)=0000057633
      DA(  52,1)=0000057634
      DA(  53,1)=0000057635
      DA(  54,1)=0000114281
      DA(  55,1)=0000000000
      DP(   1,1)=0000014280
      DP(   2,1)=0000028441
      DP(   3,1)=0000028560
      DP(   4,1)=0000028679
      DP(   5,1)=0000028798
      DP(   6,1)=0000042840
      DP(   7,1)=0000042959
      DP(   8,1)=0000057239
      DP(   9,1)=0000057358
      DP(  10,1)=0000057477
      DP(  11,1)=0000057596
      DP(  12,1)=0000057715
      DP(  13,1)=0000057834
      DP(  14,1)=0000071995
      DP(  15,1)=0000086156
      DP(  16,1)=0000100317
      DP(  17,1)=0000114478
      DP(  18,1)=0000114597
      DP(  19,1)=0000057244
      DP(  20,1)=0000057363
      DP(  21,1)=0000057482
      DP(  22,1)=0000057601
      DP(  23,1)=0000057720
      DP(  24,1)=0000057245
      DP(  25,1)=0000057483
      DP(  26,1)=0000057602
      DP(  27,1)=0000057721
      DP(  28,1)=0000057246
      DP(  29,1)=0000057365
      DP(  30,1)=0000057484
      DP(  31,1)=0000057603
      DP(  32,1)=0000057722
      DP(  33,1)=0000057247
      DP(  34,1)=0000057366
      DP(  35,1)=0000057485
      DP(  36,1)=0000057604
      DP(  37,1)=0000057723
      DP(  38,1)=0000057248
      DP(  39,1)=0000057367
      DP(  40,1)=0000057486
      DP(  41,1)=0000057605
      DP(  42,1)=0000000000
      DT(   1)=0000000000
      RETURN
      ENDIF
 !  level            0
 !  level            0
      DADT(1)=-P(001)*A(1) 
      B000001=P(002)+P(003) 
      DADT(2)=P(001)*A(1)-B000001*A(2)+P(004)*A(3) 
      DADT(3)=P(003)*A(2)-P(004)*A(3) 
      CONC=A(2)/P(005) 
      EDRUG=P(006)*CONC 
      Q000000=0.D0 
      Q000001=1.D0 
      B000008=EDRUG 
      IF(B000008 >  1.D0)THEN 
      Q000000=1.D0 
      Q000001=0.D0 
      ENDIF 
      B000011=Q000000+Q000001*EDRUG 
      EDRUG=B000011 
      B000012=P(007)/A(8) 
      B000013=1.D0-EDRUG 
      IF(B000012 == 0.D0.AND.P(008) <= 0.D0)THEN 
      IERPRD=1
      ETEXT(1)='DES SUBROUTINE: ERROR IN COMPUTATION'
      ETEXT(2)='ATTEMPT TO COMPUTE 0**POWER WITH POWER<=0.'
      RETURN
      ENDIF 
      IF(B000012 <  0.D0)THEN 
      IERPRD=1
      ETEXT(1)='DES SUBROUTINE: ERROR IN COMPUTATION'
      ETEXT(2)='ATTEMPT TO COMPUTE BASE**POWER WITH BASE<0.'
      RETURN
      ENDIF 
      B000015=0.D0 
      IF(B000012 == 0.D0)THEN 
      B000015=1.D0 
      ENDIF 
      B000016=1.D0-B000015 
      B000017=B000012+B000015 
      B000018=B000017**P(008) 
      B000019=B000016*B000018 
      DADT(4)=P(009)*A(4)*B000013*B000019-P(010)*A(4) 
      B000071=A(4)-A(5) 
      DADT(5)=P(010)*B000071 
      B000072=A(5)-A(6) 
      DADT(6)=P(010)*B000072 
      B000073=A(6)-A(7) 
      DADT(7)=P(010)*B000073 
      DADT(8)=P(010)*A(7)-P(011)*A(8) 
      IF (FIRSTEM == 1) THEN ! 1
!                      E000010 = DERIVATIVE OF DADT(1) W.R.T. A(001)
      E000010=-P(001) 
!                      F000081 = DERIVATIVE OF DADT(1) W.R.T. P(001)
      F000081=-A(1) 
!                      E000012 = DERIVATIVE OF DADT(2) W.R.T. A(001)
      E000012=P(001) 
!                      E000013 = DERIVATIVE OF DADT(2) W.R.T. A(002)
      E000013=-B000001 
!                      E000014 = DERIVATIVE OF DADT(2) W.R.T. A(003)
      E000014=P(004) 
!                      F000084 = DERIVATIVE OF DADT(2) W.R.T. P(001)
      F000084=A(1) 
!                      F000085 = DERIVATIVE OF DADT(2) W.R.T. P(003)
      F000085=-A(2) 
!                      F000086 = DERIVATIVE OF DADT(2) W.R.T. P(002)
      F000086=-A(2) 
!                      F000087 = DERIVATIVE OF DADT(2) W.R.T. P(004)
      F000087=A(3) 
!                      E000019 = DERIVATIVE OF DADT(3) W.R.T. A(002)
      E000019=P(003) 
!                      E000020 = DERIVATIVE OF DADT(3) W.R.T. A(003)
      E000020=-P(004) 
!                      F000088 = DERIVATIVE OF DADT(3) W.R.T. P(003)
      F000088=A(2) 
!                      F000089 = DERIVATIVE OF DADT(3) W.R.T. P(004)
      F000089=-A(3) 
      B000002=1.D0/P(005) 
      B000003=-A(2)/P(005)/P(005) 
!                      E000026 = DERIVATIVE OF EDRUG W.R.T. A(002)
      E000026=P(006)*B000002 
!                      F000095 = DERIVATIVE OF EDRUG W.R.T. P(005)
      F000095=P(006)*B000003 
!                      E000031 = DERIVATIVE OF B000011 W.R.T. A(002)
      E000031=Q000001*E000026 
!                      F000107 = DERIVATIVE OF B000011 W.R.T. P(005)
      F000107=Q000001*F000095 
!                      F000108 = DERIVATIVE OF B000011 W.R.T. P(006)
      F000108=Q000001*CONC 
      B000020=-P(007)/A(8)/A(8) 
!                      E000036 = DERIVATIVE OF B000013 W.R.T. A(002)
      E000036=-E000031 
      B000021=P(008)-1.D0 
      B000022=B000017**B000021 
      B000023=B000022*P(008) 
!                      E000038 = DERIVATIVE OF B000018 W.R.T. A(008)
      E000038=B000023*B000020 
!                      E000039 = DERIVATIVE OF B000019 W.R.T. A(008)
      E000039=B000016*E000038 
      B000024=P(009)*B000013*B000019 
!                      E000041 = DERIVATIVE OF DADT(4) W.R.T. A(004)
      E000041=B000024 
      B000025=P(009)*A(4)*B000019 
!                      E000042 = DERIVATIVE OF DADT(4) W.R.T. A(002)
      E000042=B000025*E000036 
      B000026=P(009)*A(4)*B000013 
!                      E000043 = DERIVATIVE OF DADT(4) W.R.T. A(008)
      E000043=B000026*E000039 
!                      E000044 = DERIVATIVE OF DADT(4) W.R.T. A(004)
      E000044=-P(010)+E000041 
      B000038=1.D0/A(8) 
!                      F000118 = DERIVATIVE OF B000013 W.R.T. P(005)
      F000118=-F000107 
!                      F000119 = DERIVATIVE OF B000013 W.R.T. P(006)
      F000119=-F000108 
      B000039=P(008)-1.D0 
      B000040=B000017**B000039 
      B000041=B000040*P(008) 
!                      F000121 = DERIVATIVE OF B000018 W.R.T. P(007)
      F000121=B000041*B000038 
      B000042=DLOG(B000017) 
      B000043=B000042*B000018 
!                      F000123 = DERIVATIVE OF B000019 W.R.T. P(008)
      F000123=B000016*B000043 
!                      F000124 = DERIVATIVE OF B000019 W.R.T. P(007)
      F000124=B000016*F000121 
      B000044=A(4)*B000013*B000019 
!                      F000127 = DERIVATIVE OF DADT(4) W.R.T. P(009)
      F000127=B000044 
      B000045=P(009)*A(4)*B000019 
!                      F000128 = DERIVATIVE OF DADT(4) W.R.T. P(006)
      F000128=B000045*F000119 
!                      F000129 = DERIVATIVE OF DADT(4) W.R.T. P(005)
      F000129=B000045*F000118 
      B000046=P(009)*A(4)*B000013 
!                      F000130 = DERIVATIVE OF DADT(4) W.R.T. P(008)
      F000130=B000046*F000123 
!                      F000131 = DERIVATIVE OF DADT(4) W.R.T. P(007)
      F000131=B000046*F000124 
!                      F000132 = DERIVATIVE OF DADT(4) W.R.T. P(010)
      F000132=-A(4) 
!                      E000109 = DERIVATIVE OF B000071 W.R.T. A(005)
      E000109=-1.D0 
!                      E000110 = DERIVATIVE OF DADT(5) W.R.T. A(005)
      E000110=P(010)*E000109 
!                      E000111 = DERIVATIVE OF DADT(5) W.R.T. A(004)
      E000111=P(010) 
!                      F000191 = DERIVATIVE OF DADT(5) W.R.T. P(010)
      F000191=B000071 
!                      E000115 = DERIVATIVE OF B000072 W.R.T. A(006)
      E000115=-1.D0 
!                      E000116 = DERIVATIVE OF DADT(6) W.R.T. A(006)
      E000116=P(010)*E000115 
!                      E000117 = DERIVATIVE OF DADT(6) W.R.T. A(005)
      E000117=P(010) 
!                      F000192 = DERIVATIVE OF DADT(6) W.R.T. P(010)
      F000192=B000072 
!                      E000121 = DERIVATIVE OF B000073 W.R.T. A(007)
      E000121=-1.D0 
!                      E000122 = DERIVATIVE OF DADT(7) W.R.T. A(007)
      E000122=P(010)*E000121 
!                      E000123 = DERIVATIVE OF DADT(7) W.R.T. A(006)
      E000123=P(010) 
!                      F000193 = DERIVATIVE OF DADT(7) W.R.T. P(010)
      F000193=B000073 
!                      E000126 = DERIVATIVE OF DADT(8) W.R.T. A(007)
      E000126=P(010) 
!                      E000127 = DERIVATIVE OF DADT(8) W.R.T. A(008)
      E000127=-P(011) 
!                      F000194 = DERIVATIVE OF DADT(8) W.R.T. P(010)
      F000194=A(7) 
!                      F000195 = DERIVATIVE OF DADT(8) W.R.T. P(011)
      F000195=-A(8) 
      ENDIF !1
      IF (MSEC == 1) THEN 
!                      E000011 = DERIVATIVE OF F000081 W.R.T. A(001)
      E000011=-1.D0 
!                      E000015 = DERIVATIVE OF F000084 W.R.T. A(001)
      E000015=1.D0 
!                      E000016 = DERIVATIVE OF F000085 W.R.T. A(002)
      E000016=-1.D0 
!                      E000017 = DERIVATIVE OF F000086 W.R.T. A(002)
      E000017=-1.D0 
!                      E000018 = DERIVATIVE OF F000087 W.R.T. A(003)
      E000018=1.D0 
!                      E000021 = DERIVATIVE OF F000088 W.R.T. A(002)
      E000021=1.D0 
!                      E000022 = DERIVATIVE OF F000089 W.R.T. A(003)
      E000022=-1.D0 
      B000004=A(2)/P(005)/P(005)/P(005) 
      B000005=A(2)/P(005)/P(005)/P(005) 
!                      F000092 = DERIVATIVE OF B000003 W.R.T. P(005)
      F000092=B000005+B000004 
!                      F000093 = DERIVATIVE OF F000090 W.R.T. P(005)
      F000093=F000092 
      B000006=-1.D0/P(005)/P(005) 
!                      E000025 = DERIVATIVE OF F000090 W.R.T. A(002)
      E000025=B000006 
!                      F000097 = DERIVATIVE OF F000094 W.R.T. P(005)
      F000097=B000003 
!                      F000098 = DERIVATIVE OF F000095 W.R.T. P(006)
      F000098=B000003 
!                      F000099 = DERIVATIVE OF F000095 W.R.T. P(005)
      F000099=P(006)*F000093 
!                      F000101 = DERIVATIVE OF F000096 W.R.T. P(005)
      F000101=F000093 
!                      E000027 = DERIVATIVE OF F000095 W.R.T. A(002)
      E000027=P(006)*E000025 
!                      E000029 = DERIVATIVE OF F000096 W.R.T. A(002)
      E000029=E000025 
      IF(B000008 >  1.D0)THEN 
!                      F000104 = DERIVATIVE OF F000102 W.R.T. P(005)
      F000104=F000099 
!                      F000105 = DERIVATIVE OF F000102 W.R.T. P(006)
      F000105=F000098 
!                      F000106 = DERIVATIVE OF F000103 W.R.T. P(005)
      F000106=F000097 
!                      E000030 = DERIVATIVE OF F000102 W.R.T. A(002)
      E000030=E000027 
      ENDIF 
!                      F000109 = DERIVATIVE OF F000107 W.R.T. P(005)
      F000109=Q000001*F000099 
!                      F000110 = DERIVATIVE OF F000107 W.R.T. P(006)
      F000110=Q000001*F000098 
!                      F000111 = DERIVATIVE OF F000108 W.R.T. P(005)
      F000111=Q000001*F000097 
!                      E000032 = DERIVATIVE OF F000107 W.R.T. A(002)
      E000032=Q000001*E000027 
!                      F000114 = DERIVATIVE OF F000112 W.R.T. P(005)
      F000114=F000111 
!                      F000115 = DERIVATIVE OF F000113 W.R.T. P(006)
      F000115=F000110 
!                      F000116 = DERIVATIVE OF F000113 W.R.T. P(005)
      F000116=F000109 
!                      E000034 = DERIVATIVE OF F000113 W.R.T. A(002)
      E000034=E000032 
      B000027=P(007)/A(8)/A(8)/A(8) 
      B000028=P(007)/A(8)/A(8)/A(8) 
!                      E000046 = DERIVATIVE OF B000020 W.R.T. A(008)
      E000046=B000028+B000027 
!                      E000047 = DERIVATIVE OF E000035 W.R.T. A(008)
      E000047=E000046 
!                      E000048 = DERIVATIVE OF E000037 W.R.T. A(008)
      E000048=E000047 
      B000029=B000021-1.D0 
      B000030=B000017**B000029 
      B000031=B000030*B000021 
!                      E000049 = DERIVATIVE OF B000022 W.R.T. A(008)
      E000049=B000031*B000020 
!                      E000050 = DERIVATIVE OF B000023 W.R.T. A(008)
      E000050=P(008)*E000049 
!                      E000051 = DERIVATIVE OF E000038 W.R.T. A(008)
      E000051=B000020*E000050 
!                      E000052 = DERIVATIVE OF E000038 W.R.T. A(008)
      E000052=B000023*E000048+E000051 
!                      E000053 = DERIVATIVE OF E000039 W.R.T. A(008)
      E000053=B000016*E000052 
!                      E000054 = DERIVATIVE OF E000040 W.R.T. A(008)
      E000054=E000053 
      B000032=P(009)*B000019 
!                      E000055 = DERIVATIVE OF B000024 W.R.T. A(002)
      E000055=B000032*E000036 
      B000033=P(009)*B000013 
!                      E000056 = DERIVATIVE OF B000024 W.R.T. A(008)
      E000056=B000033*E000039 
!                      E000057 = DERIVATIVE OF E000041 W.R.T. A(008)
      E000057=E000056 
!                      E000058 = DERIVATIVE OF E000041 W.R.T. A(002)
      E000058=E000055 
      B000034=P(009)*B000019 
      B000035=P(009)*A(4) 
!                      E000060 = DERIVATIVE OF B000025 W.R.T. A(008)
      E000060=B000035*E000039 
!                      E000061 = DERIVATIVE OF E000042 W.R.T. A(008)
      E000061=E000036*E000060 
!                      E000062 = DERIVATIVE OF E000042 W.R.T. A(004)
      E000062=E000036*B000034 
      B000036=P(009)*B000013 
      B000037=P(009)*A(4) 
!                      E000064 = DERIVATIVE OF B000026 W.R.T. A(002)
      E000064=B000037*E000036 
!                      E000065 = DERIVATIVE OF E000043 W.R.T. A(002)
      E000065=E000039*E000064 
!                      E000066 = DERIVATIVE OF E000043 W.R.T. A(004)
      E000066=E000039*B000036 
!                      E000067 = DERIVATIVE OF E000043 W.R.T. A(008)
      E000067=B000026*E000054 
!                      E000068 = DERIVATIVE OF E000044 W.R.T. A(002)
      E000068=E000058 
!                      E000069 = DERIVATIVE OF E000044 W.R.T. A(008)
      E000069=E000057 
!                      F000133 = DERIVATIVE OF F000118 W.R.T. P(005)
      F000133=-F000116 
!                      F000134 = DERIVATIVE OF F000118 W.R.T. P(006)
      F000134=-F000115 
!                      F000135 = DERIVATIVE OF F000119 W.R.T. P(005)
      F000135=-F000114 
      B000047=B000039-1.D0 
      B000048=B000017**B000047 
      B000049=B000048*B000039 
!                      F000137 = DERIVATIVE OF B000040 W.R.T. P(007)
      F000137=B000049*B000038 
      B000050=DLOG(B000017) 
      B000051=B000050*B000040 
!                      F000139 = DERIVATIVE OF B000041 W.R.T. P(008)
      F000139=P(008)*B000051 
!                      F000140 = DERIVATIVE OF B000041 W.R.T. P(007)
      F000140=P(008)*F000137 
!                      F000141 = DERIVATIVE OF B000041 W.R.T. P(008)
      F000141=B000040+F000139 
!                      F000142 = DERIVATIVE OF F000121 W.R.T. P(008)
      F000142=B000038*F000141 
!                      F000143 = DERIVATIVE OF F000121 W.R.T. P(007)
      F000143=B000038*F000140 
      B000052=1.D0/B000017 
!                      F000144 = DERIVATIVE OF B000042 W.R.T. P(007)
      F000144=B000052*B000038 
!                      F000145 = DERIVATIVE OF B000043 W.R.T. P(007)
      F000145=B000018*F000144 
!                      F000146 = DERIVATIVE OF B000043 W.R.T. P(008)
      F000146=B000042*B000043 
!                      F000147 = DERIVATIVE OF B000043 W.R.T. P(007)
      F000147=B000042*F000121+F000145 
!                      F000148 = DERIVATIVE OF F000122 W.R.T. P(007)
      F000148=F000147 
!                      F000149 = DERIVATIVE OF F000122 W.R.T. P(008)
      F000149=F000146 
!                      F000150 = DERIVATIVE OF F000123 W.R.T. P(008)
      F000150=B000016*F000149 
!                      F000151 = DERIVATIVE OF F000123 W.R.T. P(007)
      F000151=B000016*F000148 
!                      F000152 = DERIVATIVE OF F000124 W.R.T. P(007)
      F000152=B000016*F000143 
!                      F000153 = DERIVATIVE OF F000124 W.R.T. P(008)
      F000153=B000016*F000142 
!                      F000154 = DERIVATIVE OF F000125 W.R.T. P(008)
      F000154=F000153 
!                      F000155 = DERIVATIVE OF F000125 W.R.T. P(007)
      F000155=F000152 
!                      F000156 = DERIVATIVE OF F000126 W.R.T. P(007)
      F000156=F000151 
!                      F000157 = DERIVATIVE OF F000126 W.R.T. P(008)
      F000157=F000150 
      B000053=A(4)*B000019 
!                      F000158 = DERIVATIVE OF B000044 W.R.T. P(006)
      F000158=B000053*F000119 
!                      F000159 = DERIVATIVE OF B000044 W.R.T. P(005)
      F000159=B000053*F000118 
      B000054=A(4)*B000013 
!                      F000160 = DERIVATIVE OF B000044 W.R.T. P(008)
      F000160=B000054*F000123 
!                      F000161 = DERIVATIVE OF B000044 W.R.T. P(007)
      F000161=B000054*F000124 
!                      F000162 = DERIVATIVE OF F000127 W.R.T. P(007)
      F000162=F000161 
!                      F000163 = DERIVATIVE OF F000127 W.R.T. P(008)
      F000163=F000160 
!                      F000164 = DERIVATIVE OF F000127 W.R.T. P(005)
      F000164=F000159 
!                      F000165 = DERIVATIVE OF F000127 W.R.T. P(006)
      F000165=F000158 
      B000055=A(4)*B000019 
      B000056=P(009)*A(4) 
!                      F000167 = DERIVATIVE OF B000045 W.R.T. P(008)
      F000167=B000056*F000123 
!                      F000168 = DERIVATIVE OF B000045 W.R.T. P(007)
      F000168=B000056*F000124 
!                      F000169 = DERIVATIVE OF F000128 W.R.T. P(007)
      F000169=F000119*F000168 
!                      F000170 = DERIVATIVE OF F000128 W.R.T. P(008)
      F000170=F000119*F000167 
!                      F000171 = DERIVATIVE OF F000128 W.R.T. P(009)
      F000171=F000119*B000055 
!                      F000172 = DERIVATIVE OF F000128 W.R.T. P(005)
      F000172=B000045*F000135 
!                      F000173 = DERIVATIVE OF F000129 W.R.T. P(007)
      F000173=F000118*F000168 
!                      F000174 = DERIVATIVE OF F000129 W.R.T. P(008)
      F000174=F000118*F000167 
!                      F000175 = DERIVATIVE OF F000129 W.R.T. P(009)
      F000175=F000118*B000055 
!                      F000176 = DERIVATIVE OF F000129 W.R.T. P(006)
      F000176=B000045*F000134 
!                      F000177 = DERIVATIVE OF F000129 W.R.T. P(005)
      F000177=B000045*F000133 
      B000057=A(4)*B000013 
      B000058=P(009)*A(4) 
!                      F000179 = DERIVATIVE OF B000046 W.R.T. P(006)
      F000179=B000058*F000119 
!                      F000180 = DERIVATIVE OF B000046 W.R.T. P(005)
      F000180=B000058*F000118 
!                      F000181 = DERIVATIVE OF F000130 W.R.T. P(005)
      F000181=F000123*F000180 
!                      F000182 = DERIVATIVE OF F000130 W.R.T. P(006)
      F000182=F000123*F000179 
!                      F000183 = DERIVATIVE OF F000130 W.R.T. P(009)
      F000183=F000123*B000057 
!                      F000184 = DERIVATIVE OF F000130 W.R.T. P(008)
      F000184=B000046*F000157 
!                      F000185 = DERIVATIVE OF F000130 W.R.T. P(007)
      F000185=B000046*F000156 
!                      F000186 = DERIVATIVE OF F000131 W.R.T. P(005)
      F000186=F000124*F000180 
!                      F000187 = DERIVATIVE OF F000131 W.R.T. P(006)
      F000187=F000124*F000179 
!                      F000188 = DERIVATIVE OF F000131 W.R.T. P(009)
      F000188=F000124*B000057 
!                      F000189 = DERIVATIVE OF F000131 W.R.T. P(007)
      F000189=B000046*F000155 
!                      F000190 = DERIVATIVE OF F000131 W.R.T. P(008)
      F000190=B000046*F000154 
      B000059=-1.D0/A(8)/A(8) 
!                      E000071 = DERIVATIVE OF F000117 W.R.T. A(008)
      E000071=B000059 
!                      E000072 = DERIVATIVE OF F000118 W.R.T. A(002)
      E000072=-E000034 
!                      E000073 = DERIVATIVE OF F000120 W.R.T. A(008)
      E000073=E000071 
      B000060=B000039-1.D0 
      B000061=B000017**B000060 
      B000062=B000061*B000039 
!                      E000074 = DERIVATIVE OF B000040 W.R.T. A(008)
      E000074=B000062*B000020 
!                      E000075 = DERIVATIVE OF B000041 W.R.T. A(008)
      E000075=P(008)*E000074 
!                      E000076 = DERIVATIVE OF F000121 W.R.T. A(008)
      E000076=B000038*E000075 
!                      E000077 = DERIVATIVE OF F000121 W.R.T. A(008)
      E000077=B000041*E000073+E000076 
      B000063=1.D0/B000017 
!                      E000078 = DERIVATIVE OF B000042 W.R.T. A(008)
      E000078=B000063*B000020 
!                      E000079 = DERIVATIVE OF B000043 W.R.T. A(008)
      E000079=B000018*E000078 
!                      E000080 = DERIVATIVE OF B000043 W.R.T. A(008)
      E000080=B000042*E000038+E000079 
!                      E000081 = DERIVATIVE OF F000122 W.R.T. A(008)
      E000081=E000080 
!                      E000082 = DERIVATIVE OF F000123 W.R.T. A(008)
      E000082=B000016*E000081 
!                      E000083 = DERIVATIVE OF F000124 W.R.T. A(008)
      E000083=B000016*E000077 
!                      E000084 = DERIVATIVE OF F000125 W.R.T. A(008)
      E000084=E000083 
!                      E000085 = DERIVATIVE OF F000126 W.R.T. A(008)
      E000085=E000082 
      B000064=B000013*B000019 
      B000065=A(4)*B000019 
!                      E000087 = DERIVATIVE OF B000044 W.R.T. A(002)
      E000087=B000065*E000036 
      B000066=A(4)*B000013 
!                      E000088 = DERIVATIVE OF B000044 W.R.T. A(008)
      E000088=B000066*E000039 
!                      E000089 = DERIVATIVE OF F000127 W.R.T. A(008)
      E000089=E000088 
!                      E000090 = DERIVATIVE OF F000127 W.R.T. A(002)
      E000090=E000087 
!                      E000091 = DERIVATIVE OF F000127 W.R.T. A(004)
      E000091=B000064 
      B000067=P(009)*B000019 
      B000068=P(009)*A(4) 
!                      E000093 = DERIVATIVE OF B000045 W.R.T. A(008)
      E000093=B000068*E000039 
!                      E000094 = DERIVATIVE OF F000128 W.R.T. A(008)
      E000094=F000119*E000093 
!                      E000095 = DERIVATIVE OF F000128 W.R.T. A(004)
      E000095=F000119*B000067 
!                      E000096 = DERIVATIVE OF F000129 W.R.T. A(008)
      E000096=F000118*E000093 
!                      E000097 = DERIVATIVE OF F000129 W.R.T. A(004)
      E000097=F000118*B000067 
!                      E000098 = DERIVATIVE OF F000129 W.R.T. A(002)
      E000098=B000045*E000072 
      B000069=P(009)*B000013 
      B000070=P(009)*A(4) 
!                      E000100 = DERIVATIVE OF B000046 W.R.T. A(002)
      E000100=B000070*E000036 
!                      E000101 = DERIVATIVE OF F000130 W.R.T. A(002)
      E000101=F000123*E000100 
!                      E000102 = DERIVATIVE OF F000130 W.R.T. A(004)
      E000102=F000123*B000069 
!                      E000103 = DERIVATIVE OF F000130 W.R.T. A(008)
      E000103=B000046*E000085 
!                      E000104 = DERIVATIVE OF F000131 W.R.T. A(002)
      E000104=F000124*E000100 
!                      E000105 = DERIVATIVE OF F000131 W.R.T. A(004)
      E000105=F000124*B000069 
!                      E000106 = DERIVATIVE OF F000131 W.R.T. A(008)
      E000106=B000046*E000084 
!                      E000107 = DERIVATIVE OF F000132 W.R.T. A(004)
      E000107=-1.D0 
!                      E000112 = DERIVATIVE OF F000191 W.R.T. A(005)
      E000112=E000109 
!                      E000113 = DERIVATIVE OF F000191 W.R.T. A(004)
      E000113=1.D0 
!                      E000118 = DERIVATIVE OF F000192 W.R.T. A(006)
      E000118=E000115 
!                      E000119 = DERIVATIVE OF F000192 W.R.T. A(005)
      E000119=1.D0 
!                      E000124 = DERIVATIVE OF F000193 W.R.T. A(007)
      E000124=E000121 
!                      E000125 = DERIVATIVE OF F000193 W.R.T. A(006)
      E000125=1.D0 
!                      E000128 = DERIVATIVE OF F000194 W.R.T. A(007)
      E000128=1.D0 
!                      E000129 = DERIVATIVE OF F000195 W.R.T. A(008)
      E000129=-1.D0 
      ENDIF !msec
      IF (FIRSTEM == 1) THEN !2
      DA(   1,1)=E000010
      DA(   2,1)=E000012
      DA(   3,1)=E000013
      DA(   4,1)=E000014
      DA(   5,1)=E000019
      DA(   6,1)=E000020
      DA(   7,1)=E000042
      DA(   8,1)=E000044
      DA(   9,1)=E000043
      DA(  10,1)=E000111
      DA(  11,1)=E000110
      DA(  12,1)=E000117
      DA(  13,1)=E000116
      DA(  14,1)=E000123
      DA(  15,1)=E000122
      DA(  16,1)=E000126
      DA(  17,1)=E000127
      DP(   1,1)=F000081
      DP(   2,1)=F000084
      DP(   3,1)=F000086
      DP(   4,1)=F000085
      DP(   5,1)=F000087
      DP(   6,1)=F000088
      DP(   7,1)=F000089
      DP(   8,1)=F000129
      DP(   9,1)=F000128
      DP(  10,1)=F000131
      DP(  11,1)=F000130
      DP(  12,1)=F000127
      DP(  13,1)=F000132
      DP(  14,1)=F000191
      DP(  15,1)=F000192
      DP(  16,1)=F000193
      DP(  17,1)=F000194
      DP(  18,1)=F000195
      ENDIF !2
      IF (MSEC == 1) THEN
      DA(  18,1)=E000068
      DA(  19,1)=E000065
      DA(  20,1)=E000062
      DA(  21,1)=E000066
      DA(  22,1)=E000061
      DA(  23,1)=E000069
      DA(  24,1)=E000067
      DA(  25,1)=E000011
      DA(  26,1)=E000015
      DA(  27,1)=E000017
      DA(  28,1)=E000016
      DA(  29,1)=E000021
      DA(  30,1)=E000098
      DA(  31,1)=E000104
      DA(  32,1)=E000101
      DA(  33,1)=E000090
      DA(  34,1)=E000018
      DA(  35,1)=E000022
      DA(  36,1)=E000097
      DA(  37,1)=E000095
      DA(  38,1)=E000105
      DA(  39,1)=E000102
      DA(  40,1)=E000091
      DA(  41,1)=E000107
      DA(  42,1)=E000113
      DA(  43,1)=E000112
      DA(  44,1)=E000119
      DA(  45,1)=E000118
      DA(  46,1)=E000125
      DA(  47,1)=E000124
      DA(  48,1)=E000128
      DA(  49,1)=E000096
      DA(  50,1)=E000094
      DA(  51,1)=E000106
      DA(  52,1)=E000103
      DA(  53,1)=E000089
      DA(  54,1)=E000129
      DP(  19,1)=F000177
      DP(  20,1)=F000172
      DP(  21,1)=F000186
      DP(  22,1)=F000181
      DP(  23,1)=F000164
      DP(  24,1)=F000176
      DP(  25,1)=F000187
      DP(  26,1)=F000182
      DP(  27,1)=F000165
      DP(  28,1)=F000173
      DP(  29,1)=F000169
      DP(  30,1)=F000189
      DP(  31,1)=F000185
      DP(  32,1)=F000162
      DP(  33,1)=F000174
      DP(  34,1)=F000170
      DP(  35,1)=F000190
      DP(  36,1)=F000184
      DP(  37,1)=F000163
      DP(  38,1)=F000175
      DP(  39,1)=F000171
      DP(  40,1)=F000188
      DP(  41,1)=F000183
      ENDIF
      RETURN
      END
      SUBROUTINE PRIOR (ICALL,CNT)
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMPRD_INT, ONLY: NPROB,IPROB,IDXSUP,NITR_SUP,NITSUP,UST
      USE ROCM_INT,  ONLY: NREP,IREP=>NCREP
      USE NMPR_INT,  ONLY: ICMAX=>IMAXSIM
      REAL(KIND=DPSIZE) :: CNT
      REAL(KIND=DPSIZE) :: PLEV
      INTEGER(KIND=ISIZE) :: ICALL
      PLEV=0.
      ITYP=0
      NSAM=0
      ISS=0
      NTHETA=000012
      NETA=000011
      NEPS=000002
      NTHP=000011
      NETP=000008
      NEPP=0
      NPEXP=0
      CALL NWPRI(NTHETA,NETA,NEPS,NTHP,NETP,NEPP,NPEXP,ITYP,PLEV, &
                  NSAM,ISS,CNT)
      RETURN
      END
      SUBROUTINE FSIZESR(NAME_FSIZES,F_SIZES)
      USE SIZES, ONLY: ISIZE
      INTEGER(KIND=ISIZE), DIMENSION(*) :: F_SIZES
      CHARACTER(LEN=*),    DIMENSION(*) :: NAME_FSIZES
      NAME_FSIZES(01)='LTH'; F_SIZES(01)=24
      NAME_FSIZES(02)='LVR'; F_SIZES(02)=50
      NAME_FSIZES(03)='LVR2'; F_SIZES(03)=0
      NAME_FSIZES(04)='LPAR'; F_SIZES(04)=81
      NAME_FSIZES(05)='LPAR3'; F_SIZES(05)=0
      NAME_FSIZES(06)='NO'; F_SIZES(06)=0
      NAME_FSIZES(07)='MMX'; F_SIZES(07)=1
      NAME_FSIZES(08)='LNP4'; F_SIZES(08)=0
      NAME_FSIZES(09)='LSUPP'; F_SIZES(09)=1
      NAME_FSIZES(10)='LIM7'; F_SIZES(10)=0
      NAME_FSIZES(11)='LWS3'; F_SIZES(11)=0
      NAME_FSIZES(12)='MAXIDS'; F_SIZES(12)=5
      NAME_FSIZES(13)='LIM1'; F_SIZES(13)=0
      NAME_FSIZES(14)='LIM2'; F_SIZES(14)=0
      NAME_FSIZES(15)='LIM3'; F_SIZES(15)=0
      NAME_FSIZES(16)='LIM4'; F_SIZES(16)=0
      NAME_FSIZES(17)='LIM5'; F_SIZES(17)=0
      NAME_FSIZES(18)='LIM6'; F_SIZES(18)=0
      NAME_FSIZES(19)='LIM8'; F_SIZES(19)=0
      NAME_FSIZES(20)='LIM10'; F_SIZES(20)=0
      NAME_FSIZES(21)='LIM11'; F_SIZES(21)=0
      NAME_FSIZES(22)='LIM13'; F_SIZES(22)=0
      NAME_FSIZES(23)='LIM15'; F_SIZES(23)=0
      NAME_FSIZES(24)='LIM16'; F_SIZES(24)=0
      NAME_FSIZES(25)='MAXRECID'; F_SIZES(25)=0
      NAME_FSIZES(26)='PC'; F_SIZES(26)=0
      NAME_FSIZES(27)='PCT'; F_SIZES(27)=1
      NAME_FSIZES(28)='PIR'; F_SIZES(28)=55
      NAME_FSIZES(29)='PD'; F_SIZES(29)=11
      NAME_FSIZES(30)='PAL'; F_SIZES(30)=0
      NAME_FSIZES(31)='MAXFCN'; F_SIZES(31)=0
      NAME_FSIZES(32)='MAXIC'; F_SIZES(32)=0
      NAME_FSIZES(33)='PG'; F_SIZES(33)=0
      NAME_FSIZES(34)='NPOPMIXMAX'; F_SIZES(34)=0
      NAME_FSIZES(35)='MAXOMEG'; F_SIZES(35)=11
      NAME_FSIZES(36)='MAXPTHETA'; F_SIZES(36)=15
      NAME_FSIZES(37)='MAXITER'; F_SIZES(37)=20
      NAME_FSIZES(38)='ISAMPLEMAX'; F_SIZES(38)=0
      NAME_FSIZES(39)='DIMTMP'; F_SIZES(39)=0
      NAME_FSIZES(40)='DIMCNS'; F_SIZES(40)=0
      NAME_FSIZES(41)='DIMNEW'; F_SIZES(41)=0
      NAME_FSIZES(42)='PDT'; F_SIZES(42)=21
      NAME_FSIZES(43)='LADD_MAX'; F_SIZES(43)=0
      NAME_FSIZES(44)='MAXSIDL'; F_SIZES(44)=0
      NAME_FSIZES(45)='NTT'; F_SIZES(45)=12
      NAME_FSIZES(46)='NOMEG'; F_SIZES(46)=11
      NAME_FSIZES(47)='NSIGM'; F_SIZES(47)=2
      NAME_FSIZES(48)='PPDT'; F_SIZES(48)=9
      RETURN
      END SUBROUTINE FSIZESR
      SUBROUTINE MUMODEL2(THETA,MU_,ICALL,IDEF,NEWIND,&
      EVTREC,DATREC,IREV,NVNT,INDXS,F,G,H,IRGG,GG,NETAS)
      USE NMPRD4P
      USE DECLAREVARIABLES
      USE SIZES,     ONLY: DPSIZE,ISIZE
      USE PRDIMS,    ONLY: GPRD,HPRD,GERD,HERD,GPKD
      USE NMBAYES_REAL,    ONLY: PRIORINFO
      USE PRDATA, ONLY: MXSTEP=>MXSTP01
      USE NMPRD_INT, ONLY: IERPRD,IERPRDU,NETEXT,IQUIT
      USE NMPRD_CHAR,ONLY: ETEXT
      USE ROCM_REAL, ONLY: PR_Y
      USE ROCM_REAL, ONLY: PR_CT
      USE NMPRD_REAL,ONLY: ETA,EPS
      USE NMPR_INT,  ONLY: RPTI=>NRPT_IN,RPTO=>NRPT_OUT,RPTON=>NRPT_ON,PRDFL=>IUSEPRD
      USE ROCM_INT,  ONLY: NREP,IREP=>NCREP
      USE ROCM_INT,  ONLY: MIXNUM=>MIXCALL,MIXEST=>IMIXEST
      USE ROCM_REAL, ONLY: MIXP
      USE NMPRD_INT, ONLY: MSEC=>ISECDER,MFIRST=>IFRSTDER,COMACT,COMSAV,IFIRSTEM
      USE NMPRD_INT, ONLY: MDVRES,ETASXI,NPDE_MODE,NOFIRSTDERCODE
      USE NMPRD_REAL, ONLY: DV_LOQ,CDF_L,DV_LAQ,CDF_LA
      USE NMPR_REAL, ONLY: THSIMP=>THET_P,OMSIMP=>OMEG_P,SGSIMP=>SIGM_P,THSIMPR
      USE ROCM_REAL, ONLY: DEN_NP
      USE ROCM_REAL, ONLY: OMEGA=>VARNF
      USE ROCM_INT,  ONLY: NIREC=>NINDREC,NDREC=>NDATINDR
      USE ROCM_INT,  ONLY: NINDR=>NINDOBS,INDR1=>IDXOBSF,INDR2=>IDXOBSL
      USE ROCM_INT,  ONLY: LIREC=>NDATPASS
      USE NMPRD_INT, ONLY: NPROB,IPROB,IDXSUP,NITR_SUP,NITSUP
      USE NMPRD_INT, ONLY: NTHES_=>NWTHT,NETAS_=>NWETA,NEPSS_=>NWEPS
      USE NMPRD_INT, ONLY: COMACT,COMSAV
      USE ROCM_REAL, ONLY: IIDX=>DIDVALX
      USE ROCM_REAL, ONLY: CNTID=>OFV_IND
      USE CMNM1_INT, ONLY: NIND_7=>NIND
      USE PROCM_REAL,ONLY: TSTATE
      USE PROCM_INT, ONLY: A_0FLG
      USE PROCM_REAL,ONLY: A=>AMNT,DAETA,D2AETA
      USE PRMOD_REAL,ONLY: A_0,DA_0,D2A_0
      USE PROCM_REAL,ONLY: DOSTIM,DDOST,D2DOST
      USE PROCM_REAL,ONLY: DOSREC
      USE PRMOD_INT, ONLY: I_SS,ISSNOW,ISSMOD
      USE NMBAYES_REAL, ONLY: LDF
      USE PROCM_INT, ONLY: MNOW=>MTNOW,MPAST=>MTPAST,MNEXT=>MTNEXT
      USE PKERR_REAL,ONLY: MTIME
      USE PRMOD_INT, ONLY: MTDIFF
      USE NMPRD_INT, ONLY: COMACT,COMSAV
      USE NMPRD_INT, ONLY: U06,U29,UST
      USE ROCM_REAL, ONLY: MIXPT=>MIXP_RAW
      USE NM_INTERFACE, ONLY: TFI
      USE NM_INTERFACE, ONLY: TFD
      USE NMPRD_INT, ONLY: MDV100
      USE NMPRD_INT, ONLY: MDVI1
      USE NMPRD_INT, ONLY: MDVI2
      USE NMPRD_INT, ONLY: MDVI3
      USE NMPRD_INT, ONLY: NTHETA
      USE NMPRD_INT, ONLY: NREC
      USE NMPRD_REAL, ONLY: DB
      USE NMPRD_REAL, ONLY: LB
      USE NMPRD_REAL, ONLY: UB
      USE CMNM1_INT, ONLY: NIND
      USE CMNM2_INT, ONLY: ICOMPRS
      USE CMNM2_REAL, ONLY: SPEC
      USE CMNM2_INT, ONLY: NOBSIND
      USE CMNM2_INT, ONLY: NRECIND
      USE ROCM_INT, ONLY: FIRSTREC
      USE ROCM_INT, ONLY: LASTREC
      USE ROCM_INT, ONLY: FIRSTOBS
      USE ROCM_INT, ONLY: LASTOBS
      USE ROCM_INT, ONLY: FIRSTDOS
      USE ROCM_INT, ONLY: LASTDOS
      USE ROCM_INT, ONLY: EFIRSTREC
      USE ROCM_INT, ONLY: ELASTREC
      USE ROCM_INT, ONLY: EFIRSTOBS
      USE ROCM_INT, ONLY: ELASTOBS
      USE ROCM_INT, ONLY: EFIRSTDOS
      USE ROCM_INT, ONLY: ELASTDOS
      USE CMNM2_INT ,ONLY: IRECIDX
      USE NMPRD_REAL, ONLY: EPS73
      USE NMPRD_REAL, ONLY: REPS
      USE NMPRD_REAL, ONLY: TOL
      USE NMPRD_REAL, ONLY: INFNTY
      USE NMPRD_REAL, ONLY: SQINFN
      USE CMNM7_REAL, ONLY: SREPS
      USE CMNM7_REAL, ONLY: STOL
      USE CMNM4_INT, ONLY: MAXDREC
      USE CMNM4_REAL, ONLY: SMALL
      USE VERSION, ONLY: LEV
      USE NMPRD_INT, ONLY: NPROB
      USE NMPRD_INT, ONLY: IPROB
      USE ROCM_REAL, ONLY: SIGD
      USE NMPRD_INT, ONLY: IPRNV
      USE NMPRD_INT, ONLY: IPS
      USE ROCM_INT, ONLY: NINDREC
      USE ROCM_INT, ONLY: NDATINDR
      USE ROCM_INT, ONLY: NINDOBS
      USE NMPRD_INT, ONLY: IDPROB
      USE CMNM2_INT, ONLY: NOBSIND_MAX
      USE NM_BAYES_INT, ONLY: ISEED
      USE NM_BAYES_INT, ONLY: IRANM
      USE NM_BAYES_REAL, ONLY: MEPS
      USE NMDATA, ONLY: PI
      USE NM_BAYES_INT, ONLY: IKEY_PITER
      USE NM_BAYES_INT, ONLY: IKEY_TERM
      USE NMBAYES_INT, ONLY: ITERATION
      USE NMBAYES_INT, ONLY: ITER_REPORT
      USE NMBAYES_INT, ONLY: NPAT
      USE NMBAYES_INT, ONLY: SAEM_MODE
      USE NMBAYES_INT, ONLY: ITS_MODE
      USE NMBAYES_INT, ONLY: IMP_MODE
      USE NMBAYES_INT, ONLY: PITERPRINT
      USE NMBAYES_REAL, ONLY: OBJI
      USE NMBAYES_CHAR, ONLY: SBANNER
      USE NMBAYES_INT, ONLY: IBMETHOD
      USE NMBAYES_INT, ONLY: BAYES_METHOD
      USE EST_DEFS, ONLY: EST_STANDARD
      USE EST_DEFS, ONLY: EST_DEFAULT
      USE EST_DEFS, ONLY: EST_DIRECT
      USE EST_DEFS, ONLY: EST_BAYES
      USE EST_DEFS, ONLY: EST_ITS
      USE EST_DEFS, ONLY: EST_IMP
      USE EST_DEFS, ONLY: EST_IMPMAP
      USE EST_DEFS, ONLY: EST_SAEM
      USE EST_DEFS, ONLY: EST_CHAIN
      USE NMBAYES_INT, ONLY: EST_COUNTER
      USE NMBAYES_INT, ONLY: IEST_COUNTER
      USE NMBAYES_REAL, ONLY: DHPRIOR
      USE NMBAYES_REAL, ONLY: LDF
      USE NMBAYES_INT, ONLY: ITABLE
      USE NMBAYES_INT, ONLY: BAYES_EXTRA_REQUEST
      USE NMBAYES_INT, ONLY: BAYES_EXTRA
      USE NMBAYES_INT, ONLY: PATCOUNT
      USE NMBAYES_INT, ONLY: CONSTRAIN
      USE NM_BAYES_INT, ONLY: IKEY_SUBJ
      USE NM_BAYES_INT, ONLY: IKEY_BEOPRINT
      USE PNM_CONFIG, ONLY: PNM_RUN_MODE
      USE PNM_CONFIG, ONLY: PNM_NODE_NUMBER
      USE PNM_CONFIG, ONLY: PNM_NODES
      USE PNM_CONFIG, ONLY: PNM_COMPUTERS
      USE PNM_CONFIG, ONLY: PNM_PARAPRINT
      USE PNM_CONFIG, ONLY: PNM_SPLIT
      USE PNM_CONFIG, ONLY: PNM_PARSE_NUMBER
      USE PNM_CONFIG, ONLY: PNM_TRANSFER_TYPE
      USE PNM_CONFIG, ONLY: PNM_TIMEOUTI
      USE PNM_CONFIG, ONLY: PNM_TIMEOUT
      USE PNM_CONFIG, ONLY: PNM_COMMAND
      USE PNM_CONFIG, ONLY: PNM_WORKER_DIRS
      USE PNM_CONFIG, ONLY: PNM_MTOUCH
      USE PNM_CONFIG, ONLY: PNM_MSLEEP
      USE PNM_CONFIG, ONLY: PNM_WTOUCH
      USE PNM_CONFIG, ONLY: PNM_WSLEEP
      USE NMBAYES_CHAR, ONLY: RANMETHOD
      USE NMBAYES_CHAR, ONLY: SRANMETHOD
      USE NMBAYES_CHAR, ONLY: TRANMETHOD
      USE NMBAYES_CHAR, ONLY: CRANMETHOD
      USE NMBAYES_CHAR, ONLY: CCRANMETHOD
      USE NMBAYES_INT, ONLY: ETASTYPE
      USE NMPRD_INT, ONLY: NETAZ
      USE NMPRD_INT, ONLY: NEPSZ
      USE NMBAYES_REAL, ONLY: OMEGANNL
      USE NM_BAYES_INT, ONLY: NM_STEP,BASE_STEP,EST_STEP,COV_STEP,TABLE_STEP,SIML_STEP,INE_STEP,&
&NONP_STEP
      USE NMBAYES_INT, ONLY: MUFIRSTREC
      USE NMBAYES_INT, ONLY: OBJQUICK
      USE CVIDAROOT, ONLY: NRTFN,NRTCT,RTINFO,RTSIGNAL,TRTINFO,YRTINFO,YPRTINFO,GRTINFO
      IMPLICIT REAL(KIND=DPSIZE) (A-Z)
      REAL(KIND=DPSIZE)   :: MU_(*)
      INTEGER NEWIND
      REAL(KIND=DPSIZE) :: EVTREC
 991  FORMAT (35F14.4)
 992  FORMAT (35E15.7)
 998  FORMAT (1PE22.15,1X,1PE22.15/)
      SAVE
      INTEGER(KIND=ISIZE) :: FIRSTEM
      INTEGER(KIND=ISIZE) :: ICALL,IDEF,IREV,NVNT,INDXS,IRGG,NETAS
      DIMENSION :: IDEF(7,*),THETA(*),EVTREC(IREV,*),INDXS(*),GG(IRGG,GPKD+1,*)
      INTEGER(KIND=ISIZE), POINTER :: S1NUM, S2NUM, S1NIT, S2NIT, S1IT, S2IT
      REAL(KIND=DPSIZE), POINTER :: DEN_,CDEN_(:)
! MIXPT=>MIXP_RAW:  Mixture probabilities for data-average block
! TFI:  function converts integer argument i to text: TFI(i)
! TFD:  function converts double precision argument d to text: TFD(d)
! MDV100: =0 if no MDV data itme, =1 if original MDV in data set is 0 or 1, =2 if original MDV in data set is 100 or 101
! MDVI1: DO not ignore MDV>100 records in OBJ routine
! MDVI2: DO not ignore MDV>100 records in OBJ2 routine
! MDVI3: DO not ignore MDV>100 records in OBJ3 routine
! NTHETA: Length of theta; may be set to 1 when length is 0
! DB: Upper bound minus lower bound (UB(I)-LB(I))
! LB: LB(I)=Lower bound for THETA(I)
! UB: UB(I)=Upper bound for THETA(I)
! NIND: Total number of individuals; set in INPT
! ICOMPRS: 0 = usual format for var-covar output, 1 = compressed format
! modified such that 0 = usual format, 9 or fewer elements, 1 = usual format more than 9 elements and 2 = compressed format
! SPEC:  = 1E10, used as a flag in var-covar
! NOBSIND: Number of observation records in individual record
! NRECIND: No. of records / this individual;
! NREC: No. of records in entire dataset;
! number of data records in individual record
! the following 12 items can be compared against NDREC
! FIRSTREC: first record of subject
! LASTREC: last record of subject
! FIRSTOBS: first observation record of subject (for which MDV=0 or 100)
! LASTOBS: last observation record of subject (for which MDV=0 or 100)
! FIRSTDOS: First record of subject with EVID=1 or EVID=4.  FIRSTDOS=-1 when there are no dose records, or PREDPP is not used.
! LASTDOS: Last record of subject with EVID=1 or EVID=4.  LASTDOS=-1 when there are no dose records, or PREDPP is not used.
! EFIRSTREC: first record of subject during estimation (so, among records for which MDV=0 or MDV=1)
! ELASTREC: last record of subject during estimation (so, among records for which MDV=0 or MDV=1)
! EFIRSTOBS: first observation record of subject  during estimation (so, among records for which MDV=0)
! ELASTOBS: last observation record of subject during estimation (so, among records for which MDV=0)
! EFIRSTDOS: First record of subject with EVID=1 or EVID=4 during estimation (so, among records for which MDV=1).  EFIRSTDOS=-1 if no dose record PREDPP is not
! ELASTDOS: Last record of subject with EVID=1 or EVID=4  during estimation (so, among records for which MDV=1).  ELASTDOS=-1 if no dose record PREDPP is not us
! IRECIDX: IRECIDX+1 is starting absolute record number in the data set for the present subject (so while NDREC always sets to 1 for the first record of each su
! During ICALL=1 (INFN initialization), ICALL=3 (INFN finalization), or ICALL=4 (simulation)
! only FIRSTREC and LASTREC are available.  The other values will be set to -1.
! EPS73: Mantissa length.  This is the number 2**(-m), where m is the number of binary digits occurring in the double precision mantissa.
! REPS: Same as REPST; Machine precision. Smallest double precision number that when added to 1 yields a number that is not 1 (same as MEPS)
! TOL: same as TOLT
! INFNTY: SQRT (LARGET); LARGET is largest double precision number representable by the machine
! SQINFN: SQRT (INFNTY)
! SREPS: same as SREPST
! STOL: same as STOLT
! MAXDREC: Maximum number of data record for an individual up to & including this individual
! SMALL: SQRT(TOL*REPS)
! LEV: Level of release
! NPROB: Number of problems
! IPROB: The number of the current problem
! SIGD: minimum value of significant digits; min(DIFA)
! IPRNV: 0 = no printing of NONMEM input info. after 1st iteration of active 1st(2nd) level super problem
! 1 = normal printing for active 1st (2nd) level super problem.
! IPS: Indicator variable,
! 1-> Population data,
! 2-> Single-subject data
! NINDREC (alias NIREC): The number of the individual record at current call (this the subject number)
! NDATINDR (alias NDREC): The number of the data record within the individual record at the current call
! NINDOBS: Number of individual records containing an observation record
! IDPROB: Problem ID
! NOBSIND_MAX: Maximum number of observations for any subject
! ISEED: Present seed number of ranmethods 0-3
! IRANM: Random method for Monte Carlo EM methods
! MEPS: Machine double precision (typically about 1.0E-15)
! PI: Contains the number PI
! IKEY_PITER: =1 to printer iterations, in response to ctrl-I, or signal file iter.sig
! IKEY_TERM: =5 to end run, in response to ctrl-E, or stop.sig file
! =11 to end mode, in response to ctrl-K, or next.sig file
! ITERATION: Present iteration of an EM/Bayesian Method (always non-negative).
! ITER_REPORT: Iteration number that is reported to output (can be negative, if during a burn period).
! NPAT: Number of subjects that have data
! SAEM_MODE: =0 Bayes method
! =1 Stochastic period of SAEM, IMP, ITS, DIRECT, IMPMAP
! =2 reduced stochastic/accumulative period of SAEM
! ITS_MODE: =0 no MAP estimation
! =1 MAP estimation on first iteration
! =2 MAP estimation all iterations (IMPMAP)
! =3 ITS
! IMP_MODE: =0 no Monte Carlo  importance sampling
! =1 Monte Carlo importance sampling
! PITERPRINT: =1 print iteration information
! =0 don’t print iteration information
! OBJI: OBJI(NIREC,1)= objective function value for subject NIREC
! SBANNER: Text to stimation method
! IBMETHOD: Holds METHOD type
! EST_* are defined in module EST_DEFS
! EST_STANDARD (FO/FOCE/LaPLCE)
! EST_DIRECT
! EST_BAYES
! EST_ITS
! EST_SAEM
! EST_IMP
! EST_IMPMAP
! EST_CHAIN
! BAYES_METHOD: ==0 FOR REGULAR BAYES, =1 FOR NUTS
! EST_COUNTER: Total number of $EST statements.
! IEST_COUNTER: Present $EST statement being executed.
! DHPRIOR: Prior portion for EM methods
! LDF: LDF(i)=Loss of degrees of freedom for omega i (usually=1)..  Used in correction for EM analyses only.
! ITABLE: Table number (#TBLN in NONMEM report file, and table numbers in extra output files, such as .ext, .phi, .phm, etc.)
! BAYES_EXTRA_REQUEST: See example8
! BAYES_EXTRA: See example8
! PATCOUNT: Number of subjects with data
! CONSTRAIN: CONSTRAIN setting by which CONSTRAINT routine responds
! IKEY_SUBJ: IF IKEY_SUBJ=20, then ctrl-T or subject.sig signal
! IKEY_BEOPRINT: Toggle to ctrl-B or sending paraprint.sig file.
! PNM_RUN_MODE: May have values:
! PNM_MANAGER
! PNM_WORKER
! PNM_SINGLE
! PNM_NODE_NUMBER: 1=MANAGER,  or SINGLE
! 2-PNM_NODES=WORKER
! PNM_NODES: Number of NODES
! PNM_COMPUTERS: COMPUTERS setting in pnm file
! PNM_PARAPRINT: PARAPRINT setting in pnm file
! PNM_SPLIT: PARSE_TYPE setting in pnm file
! PNM_PARSE_NUMBER: PARSE_NUM
! PNM_TRANSFER_TYPE: TRANSFER_TYPE
! PNM_TIMEOUTI: TIMEOUTI
! PNM_TIMEOUT: TIMEOUT
! PNM_COMMAND: Array pnm commands
! PNM_WORKER_DIRS: Array with worker directories (1-nodes-1)
! PNM_MTOUCH: MTOUCH
! PNM_MSLEEP: MSLEEP
! PNM_WTOUCH: WTOUCH
! PNM_WSLEEP: WSLEEP
! RANMETHOD: $EST RANMETHOD
! SRANMETHOD: $SIML RANMETHOD
! TRANMETHOD: $TABLE RANMETHOD
! CRANMETHOD: $EST METHOD=CHAIN RANMETHOD
! CCRANMETHOD: $CHAIN RANMETHOD
! ETASTYPE: ETASTYPE
! NETAZ: Maximum eta index to have non-zero OMEGA diagonal
! NEPSZ: Maximum eps index to have non-zero SIGMA diagonal
! OMEGANNL: For each x,y in
! $ANNEAL x:y
! OMEGANNL(x)=y
! Those not defined in $ANNEAL are set to -1
! Used in CONSTRAINT.f90
! NM_STEP CAN HAVE THE FOLLOWING VALUES: BASE_STEP, EST_STEP,COV_STEP,TABLE_STEP,SIML_STEP,INE_STEP,NONP_STEP
! MUFIRSTREC: SET TO 1 IN $PK OR $PRED TO CAUSE COVARIATES OF ONLY FIRST RECORD OF SUBJECT TO BE USED IN ASSESSING MU
! OBJQUICK: SET TO 1 IN $PRED OR $PK TO USE QUICK CODE FOR NOUTURN SAMPLING.  ONLY SIMPLE MODELS, WITH NO $MIX, OR $LEVEL
! CVIDAROOT USED FOR ADVAN14 (SEE CVODEU.F90 COMMENTS), OR ADVAN15 (SEE IDAU.F90 COMMENTS) FOR ROOT FINDING
      S1NUM=>IDXSUP(1)
      S2NUM=>IDXSUP(2)
      S1NIT=>NITR_SUP(1)
      S2NIT=>NITR_SUP(2)
      S1IT=>NITSUP(1)
      S2IT=>NITSUP(2)
      DEN_=>DEN_NP(1)
      CDEN_=>DEN_NP(2:)
      FIRSTEM=IFIRSTEM
      IF (ICALL <= 1) THEN
      CALL ASSOCNMPRD4
      IDEF(   1,0001)=  -9
      IDEF(   1,0002)=  -1
      IDEF(   1,0003)=   1
      IDEF(   1,0004)=   0
      IDEF(   2,0003)=   0
      IDEF(   2,0004)=   0
      IDEF(   3,0002)=  12
      IDEF(   3,0003)=  13
      CALL GETETA(ETA)
      IF (IQUIT == 1) RETURN
      RETURN
      ENDIF
      IF (NEWIND /= 2) THEN
      IF (ICALL == 4) THEN
      CALL SIMETA(ETA)
      ELSE
      CALL GETETA(ETA)
      ENDIF
      IF (IQUIT == 1) RETURN
      ENDIF
 !  level            0
      WT=EVTREC(NVNT,009)
      BAYES_EXTRA_REQUEST=1.D0
      nThin=THETA(012)
      B000001=WT/70.D0
      B000002=DLOG(B000001)
      VWT=B000002
      MU_1=THETA(001)+0.75D0*VWT
      MU_(001)=MU_1
      MU_2=THETA(002)+0.75D0*VWT
      MU_(002)=MU_2
      MU_3=THETA(003)+VWT
      MU_(003)=MU_3
      MU_4=THETA(004)+VWT
      MU_(004)=MU_4
      MU_5=THETA(005)
      MU_(005)=MU_5
      MU_6=THETA(006)
      MU_(006)=MU_6
      MU_7=THETA(007)
      MU_(007)=MU_7
      MU_8=THETA(008)
      MU_(008)=MU_8
      MU_9=THETA(009)
      MU_(009)=MU_9
      MU_10=THETA(010)
      MU_(010)=MU_10
      MU_11=THETA(011)
      MU_(011)=MU_11
       RETURN
      CALL EXTRASEND()
      B000003=MU_1+ETA(001)
      B000004=DEXP(B000003)
      CL=B000004
      B000005=MU_2+ETA(002)
      B000006=DEXP(B000005)
      Q=B000006
      B000007=MU_3+ETA(003)
      B000008=DEXP(B000007)
      V1=B000008
      B000009=MU_4+ETA(004)
      B000010=DEXP(B000009)
      V2=B000010
      B000011=MU_5+ETA(005)
      B000012=DEXP(B000011)
      KA=B000012
      B000013=MU_6+ETA(006)
      B000014=DEXP(B000013)
      MTT=B000014
      B000015=MU_7+ETA(007)
      B000016=DEXP(B000015)
      CIRC0=B000016
      B000017=MU_8+ETA(008)
      B000018=DEXP(B000017)
      ALPHA=B000018
      B000019=MU_9+ETA(009)
      B000020=DEXP(B000019)
      GAMMA=B000020
      B000021=MU_10+ETA(010)
      B000022=DEXP(B000021)
      SIG1=B000022
      B000023=MU_11+ETA(011)
      B000024=DEXP(B000023)
      SIG2=B000024
      K10=CL/V1
      K12=Q/V1
      K21=Q/V2
      KTR=4.D0/MTT
      KPROL=KTR
      KCIRC=KTR
      IF(A_0FLG == 1)THEN
      A_0(1)=0.D0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(2)=0.D0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(3)=0.D0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(4)=CIRC0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(5)=CIRC0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(6)=CIRC0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(7)=CIRC0
      ENDIF
      IF(A_0FLG == 1)THEN
      A_0(8)=CIRC0
      ENDIF
      S2=V1
      S3=V2
      B000053=ITER_REPORT/nThin
      B000055=ITER_REPORT/nThin
      B000054=INT(B000055)
      IF(BAYES_EXTRA == 1.D0.AND.NIREC == 1.D0.AND.NDREC == 1.D0.AND. &
      ITER_REPORT >  0.D0.AND.B000053 == B000054)THEN
      IF(FIRST_WRITE_PAR == 0)THEN
      OPEN(unit=52,FILE='./par.txt')
      FIRST_WRITE_PAR=1
      ENDIF
      WRITE(52,'(I12,1X,50(1X,1PG19.10E3))') ITER_REPORT, &
      THETA(1), THETA(2), THETA(3), THETA(4), THETA(5), THETA(6), THETA(7), &
      THETA(8), THETA(9), THETA(10), THETA(11), &
      OMEGA(1,1), OMEGA(2,1), OMEGA(2,2), &
      OMEGA(3,1), OMEGA(3,2), OMEGA(3,3), &
      OMEGA(4,1), OMEGA(4,2), OMEGA(4,3), OMEGA(4,4), &
      OMEGA(5,1), OMEGA(5,2), OMEGA(5,3), OMEGA(5,4), OMEGA(5,5), &
      OMEGA(6,1), OMEGA(6,2), OMEGA(6,3), OMEGA(6,4), OMEGA(6,5), OMEGA(6,6), &
      OMEGA(7,1), OMEGA(7,2), OMEGA(7,3), OMEGA(7,4), OMEGA(7,5), OMEGA(7,6), OMEGA(7,7), &
      OMEGA(8,1), OMEGA(8,2), OMEGA(8,3), OMEGA(8,4), OMEGA(8,5), OMEGA(8,6), OMEGA(8,7), OMEGA(8,8&
&)
      ENDIF
      B000067=ITER_REPORT/nThin
      B000069=ITER_REPORT/nThin
      B000068=INT(B000069)
      IF(BAYES_EXTRA == 1.D0.AND.NDREC == 1.D0.AND.ITER_REPORT >  0.D0 &
      .AND.B000067 == B000068)THEN
      IF(FIRST_WRITE_IPAR == 0)THEN
      OPEN(unit=50,FILE='./ipar'//TFI(PNM_NODE_NUMBER)//'.txt')
      FIRST_WRITE_IPAR=1
      ENDIF
      WRITE(50,'(I12,1X,F14.0,13(1X,1PG12.5))') ITER_REPORT, EVTREC(NVNT,002), &
      ETA(1), ETA(2), ETA(3), ETA(4), ETA(5), ETA(6), ETA(7), ETA(8)
      ENDIF
      P000001=KA
      P000002=K10
      P000003=K12
      P000004=K21
      P000005=V1
      P000006=ALPHA
      P000007=CIRC0
      P000008=GAMMA
      P000009=KPROL
      P000010=KTR
      P000011=KCIRC
      IF (FIRSTEM == 1) THEN
!                      A000098 = DERIVATIVE OF SIG1 W.R.T. ETA(010)
      A000098=B000022
!                      A000103 = DERIVATIVE OF SIG2 W.R.T. ETA(011)
      A000103=B000024
      B000025=1.D0/V1
!                      A000106 = DERIVATIVE OF K10 W.R.T. ETA(001)
      A000106=B000025*B000004
      B000026=-CL/V1/V1
!                      A000107 = DERIVATIVE OF K10 W.R.T. ETA(003)
      A000107=B000026*B000008
      B000033=1.D0/V1
!                      A000122 = DERIVATIVE OF K12 W.R.T. ETA(002)
      A000122=B000033*B000006
      B000034=-Q/V1/V1
!                      A000123 = DERIVATIVE OF K12 W.R.T. ETA(003)
      A000123=B000034*B000008
      B000041=1.D0/V2
!                      A000138 = DERIVATIVE OF K21 W.R.T. ETA(002)
      A000138=B000041*B000006
      B000042=-Q/V2/V2
!                      A000139 = DERIVATIVE OF K21 W.R.T. ETA(004)
      A000139=B000042*B000010
      B000049=-4.D0/MTT/MTT
!                      A000154 = DERIVATIVE OF KTR W.R.T. ETA(006)
      A000154=B000049*B000014
      IF(A_0FLG == 1)THEN
      DA_0(004,007)=B000016
      ENDIF
      IF(A_0FLG == 1)THEN
      DA_0(005,007)=B000016
      ENDIF
      IF(A_0FLG == 1)THEN
      DA_0(006,007)=B000016
      ENDIF
      IF(A_0FLG == 1)THEN
      DA_0(007,007)=B000016
      ENDIF
      IF(A_0FLG == 1)THEN
      DA_0(008,007)=B000016
      ENDIF
!                      A000176 = DERIVATIVE OF S2 W.R.T. ETA(003)
      A000176=B000008
!                      A000178 = DERIVATIVE OF S3 W.R.T. ETA(004)
      A000178=B000010
!                      A000180 = DERIVATIVE OF P000001 W.R.T. ETA(005)
      A000180=B000012
!                      A000182 = DERIVATIVE OF P000002 W.R.T. ETA(003)
      A000182=A000107
!                      A000183 = DERIVATIVE OF P000002 W.R.T. ETA(001)
      A000183=A000106
!                      A000187 = DERIVATIVE OF P000003 W.R.T. ETA(003)
      A000187=A000123
!                      A000188 = DERIVATIVE OF P000003 W.R.T. ETA(002)
      A000188=A000122
!                      A000192 = DERIVATIVE OF P000004 W.R.T. ETA(004)
      A000192=A000139
!                      A000193 = DERIVATIVE OF P000004 W.R.T. ETA(002)
      A000193=A000138
!                      A000197 = DERIVATIVE OF P000005 W.R.T. ETA(003)
      A000197=B000008
!                      A000199 = DERIVATIVE OF P000006 W.R.T. ETA(008)
      A000199=B000018
!                      A000201 = DERIVATIVE OF P000007 W.R.T. ETA(007)
      A000201=B000016
!                      A000203 = DERIVATIVE OF P000008 W.R.T. ETA(009)
      A000203=B000020
!                      A000205 = DERIVATIVE OF P000009 W.R.T. ETA(006)
      A000205=A000154
!                      A000207 = DERIVATIVE OF P000010 W.R.T. ETA(006)
      A000207=A000154
!                      A000209 = DERIVATIVE OF P000011 W.R.T. ETA(006)
      A000209=A000154
      GG(0001,1,1)=P000001
      GG(0001,0006,1)=A000180
      GG(0002,1,1)=P000002
      GG(0002,0002,1)=A000183
      GG(0002,0004,1)=A000182
      GG(0003,1,1)=P000003
      GG(0003,0003,1)=A000188
      GG(0003,0004,1)=A000187
      GG(0004,1,1)=P000004
      GG(0004,0003,1)=A000193
      GG(0004,0005,1)=A000192
      GG(0005,1,1)=P000005
      GG(0005,0004,1)=A000197
      GG(0006,1,1)=P000006
      GG(0006,0009,1)=A000199
      GG(0007,1,1)=P000007
      GG(0007,0008,1)=A000201
      GG(0008,1,1)=P000008
      GG(0008,0010,1)=A000203
      GG(0009,1,1)=P000009
      GG(0009,0007,1)=A000205
      GG(0010,1,1)=P000010
      GG(0010,0007,1)=A000207
      GG(0011,1,1)=P000011
      GG(0011,0007,1)=A000209
      GG(0012,1,1)=S2
      GG(0012,0004,1)=A000176
      GG(0013,1,1)=S3
      GG(0013,0005,1)=A000178
      ELSE
      GG(0001,1,1)=P000001
      GG(0002,1,1)=P000002
      GG(0003,1,1)=P000003
      GG(0004,1,1)=P000004
      GG(0005,1,1)=P000005
      GG(0006,1,1)=P000006
      GG(0007,1,1)=P000007
      GG(0008,1,1)=P000008
      GG(0009,1,1)=P000009
      GG(0010,1,1)=P000010
      GG(0011,1,1)=P000011
      GG(0012,1,1)=S2
      GG(0013,1,1)=S3
      ENDIF
      IF (MSEC == 1) THEN
!                      A000100 = DERIVATIVE OF A000098 W.R.T. ETA(010)
      A000100=B000022
!                      A000105 = DERIVATIVE OF A000103 W.R.T. ETA(011)
      A000105=B000024
      B000029=-1.D0/V1/V1
!                      A000110 = DERIVATIVE OF B000025 W.R.T. ETA(003)
      A000110=B000029*B000008
!                      A000111 = DERIVATIVE OF A000106 W.R.T. ETA(003)
      A000111=B000004*A000110
!                      A000112 = DERIVATIVE OF A000106 W.R.T. ETA(001)
      A000112=B000025*B000004
      B000030=-1.D0/V1/V1
!                      A000113 = DERIVATIVE OF B000026 W.R.T. ETA(001)
      A000113=B000030*B000004
      B000031=CL/V1/V1/V1
!                      A000114 = DERIVATIVE OF B000026 W.R.T. ETA(003)
      A000114=B000031*B000008
      B000032=CL/V1/V1/V1
!                      A000115 = DERIVATIVE OF B000026 W.R.T. ETA(003)
      A000115=B000032*B000008+A000114
!                      A000116 = DERIVATIVE OF A000107 W.R.T. ETA(003)
      A000116=B000008*A000115
!                      A000117 = DERIVATIVE OF A000107 W.R.T. ETA(003)
      A000117=B000026*B000008+A000116
      B000037=-1.D0/V1/V1
!                      A000126 = DERIVATIVE OF B000033 W.R.T. ETA(003)
      A000126=B000037*B000008
!                      A000127 = DERIVATIVE OF A000122 W.R.T. ETA(003)
      A000127=B000006*A000126
!                      A000128 = DERIVATIVE OF A000122 W.R.T. ETA(002)
      A000128=B000033*B000006
      B000038=-1.D0/V1/V1
!                      A000129 = DERIVATIVE OF B000034 W.R.T. ETA(002)
      A000129=B000038*B000006
      B000039=Q/V1/V1/V1
!                      A000130 = DERIVATIVE OF B000034 W.R.T. ETA(003)
      A000130=B000039*B000008
      B000040=Q/V1/V1/V1
!                      A000131 = DERIVATIVE OF B000034 W.R.T. ETA(003)
      A000131=B000040*B000008+A000130
!                      A000132 = DERIVATIVE OF A000123 W.R.T. ETA(003)
      A000132=B000008*A000131
!                      A000133 = DERIVATIVE OF A000123 W.R.T. ETA(003)
      A000133=B000034*B000008+A000132
      B000045=-1.D0/V2/V2
!                      A000142 = DERIVATIVE OF B000041 W.R.T. ETA(004)
      A000142=B000045*B000010
!                      A000143 = DERIVATIVE OF A000138 W.R.T. ETA(004)
      A000143=B000006*A000142
!                      A000144 = DERIVATIVE OF A000138 W.R.T. ETA(002)
      A000144=B000041*B000006
      B000046=-1.D0/V2/V2
!                      A000145 = DERIVATIVE OF B000042 W.R.T. ETA(002)
      A000145=B000046*B000006
      B000047=Q/V2/V2/V2
!                      A000146 = DERIVATIVE OF B000042 W.R.T. ETA(004)
      A000146=B000047*B000010
      B000048=Q/V2/V2/V2
!                      A000147 = DERIVATIVE OF B000042 W.R.T. ETA(004)
      A000147=B000048*B000010+A000146
!                      A000148 = DERIVATIVE OF A000139 W.R.T. ETA(004)
      A000148=B000010*A000147
!                      A000149 = DERIVATIVE OF A000139 W.R.T. ETA(004)
      A000149=B000042*B000010+A000148
      B000051=4.D0/MTT/MTT/MTT
!                      A000156 = DERIVATIVE OF B000049 W.R.T. ETA(006)
      A000156=B000051*B000014
      B000052=4.D0/MTT/MTT/MTT
!                      A000157 = DERIVATIVE OF B000049 W.R.T. ETA(006)
      A000157=B000052*B000014+A000156
!                      A000158 = DERIVATIVE OF A000154 W.R.T. ETA(006)
      A000158=B000014*A000157
!                      A000159 = DERIVATIVE OF A000154 W.R.T. ETA(006)
      A000159=B000049*B000014+A000158
      IF(A_0FLG == 1)THEN
      D2A_0(004,007,007)=B000016
      ENDIF
      IF(A_0FLG == 1)THEN
      D2A_0(005,007,007)=B000016
      ENDIF
      IF(A_0FLG == 1)THEN
      D2A_0(006,007,007)=B000016
      ENDIF
      IF(A_0FLG == 1)THEN
      D2A_0(007,007,007)=B000016
      ENDIF
      IF(A_0FLG == 1)THEN
      D2A_0(008,007,007)=B000016
      ENDIF
!                      A000177 = DERIVATIVE OF A000176 W.R.T. ETA(003)
      A000177=B000008
!                      A000179 = DERIVATIVE OF A000178 W.R.T. ETA(004)
      A000179=B000010
!                      A000181 = DERIVATIVE OF A000180 W.R.T. ETA(005)
      A000181=B000012
!                      A000184 = DERIVATIVE OF A000182 W.R.T. ETA(003)
      A000184=A000117
!                      A000185 = DERIVATIVE OF A000183 W.R.T. ETA(001)
      A000185=A000112
!                      A000186 = DERIVATIVE OF A000183 W.R.T. ETA(003)
      A000186=A000111
!                      A000189 = DERIVATIVE OF A000187 W.R.T. ETA(003)
      A000189=A000133
!                      A000190 = DERIVATIVE OF A000188 W.R.T. ETA(002)
      A000190=A000128
!                      A000191 = DERIVATIVE OF A000188 W.R.T. ETA(003)
      A000191=A000127
!                      A000194 = DERIVATIVE OF A000192 W.R.T. ETA(004)
      A000194=A000149
!                      A000195 = DERIVATIVE OF A000193 W.R.T. ETA(002)
      A000195=A000144
!                      A000196 = DERIVATIVE OF A000193 W.R.T. ETA(004)
      A000196=A000143
!                      A000198 = DERIVATIVE OF A000197 W.R.T. ETA(003)
      A000198=B000008
!                      A000200 = DERIVATIVE OF A000199 W.R.T. ETA(008)
      A000200=B000018
!                      A000202 = DERIVATIVE OF A000201 W.R.T. ETA(007)
      A000202=B000016
!                      A000204 = DERIVATIVE OF A000203 W.R.T. ETA(009)
      A000204=B000020
!                      A000206 = DERIVATIVE OF A000205 W.R.T. ETA(006)
      A000206=A000159
!                      A000208 = DERIVATIVE OF A000207 W.R.T. ETA(006)
      A000208=A000159
!                      A000210 = DERIVATIVE OF A000209 W.R.T. ETA(006)
      A000210=A000159
      GG(0001,0006,0006)=A000181
      GG(0002,0002,0002)=A000185
      GG(0002,0004,0002)=A000186
      GG(0002,0004,0004)=A000184
      GG(0003,0003,0003)=A000190
      GG(0003,0004,0003)=A000191
      GG(0003,0004,0004)=A000189
      GG(0004,0003,0003)=A000195
      GG(0004,0005,0003)=A000196
      GG(0004,0005,0005)=A000194
      GG(0005,0004,0004)=A000198
      GG(0006,0009,0009)=A000200
      GG(0007,0008,0008)=A000202
      GG(0008,0010,0010)=A000204
      GG(0009,0007,0007)=A000206
      GG(0010,0007,0007)=A000208
      GG(0011,0007,0007)=A000210
      GG(0012,0004,0004)=A000177
      GG(0013,0005,0005)=A000179
      ENDIF
      RETURN
      END
